<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>PingCap的Rust训练课程1：熟悉Rust工具链 - 子实</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="子实"><meta name="msapplication-TileImage" content="/img/avatar-o.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="子实"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="PingCap的Rust训练课程1：熟悉Rust工具链"><meta property="og:type" content="article"><meta property="og:title" content="PingCap的Rust训练课程1：熟悉Rust工具链"><meta property="og:url" content="https://zlotus.github.io/2022/02/22/pna-rust-project-1/"><meta property="og:site_name" content="子实"><meta property="og:description" content="PingCap的Rust训练课程1：熟悉Rust工具链"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://zlotus.github.io/img/og_image.png"><meta property="article:published_time" content="2022-02-22T14:22:22.000Z"><meta property="article:modified_time" content="2022-02-22T14:22:22.000Z"><meta property="article:author" content="子实"><meta property="article:tag" content="Rust"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><meta property="twitter:creator" content="@Zealot_uS"><meta property="twitter:site" content="Zealot_uS"><link rel="publisher" href="+LotusQin"><meta property="fb:admins" content="qinzishi"><meta property="fb:app_id" content="qinzishi"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://zlotus.github.io/2022/02/22/pna-rust-project-1/"},"headline":"PingCap的Rust训练课程1：熟悉Rust工具链","image":["https://zlotus.github.io/img/og_image.png"],"datePublished":"2022-02-22T14:22:22.000Z","dateModified":"2022-02-22T14:22:22.000Z","author":{"@type":"Person","name":"子实"},"publisher":{"@type":"Organization","name":"子实","logo":{"@type":"ImageObject","url":"https://zlotus.github.io/img/opm_sq.png"}},"description":"PingCap的Rust训练课程1：熟悉Rust工具链"}</script><link rel="icon" href="/img/avatar-o.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><!--!--><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/opm_sq.png" alt="子实" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/2014/07/09/about-me/">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/zlotus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-9-tablet is-9-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-02-22T14:22:22.000Z" title="2/22/2022, 10:22:22 PM">2022-02-22</time>发表</span><span class="level-item"><time dateTime="2022-02-22T14:22:22.000Z" title="2/22/2022, 10:22:22 PM">2022-02-22</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Programming/">Programming</a></span><span class="level-item">44 分钟读完 (大约6647个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">PingCap的Rust训练课程1：熟悉Rust工具链</h1><div class="content"><article class="message message-immersive is-warning">
<div class="message-body">
<i class="fas fa-exclamation-triangle mr-2"></i>本文内容大多翻译自原文：<a target="_blank" rel="noopener" href="https://github.com/pingcap/talent-plan/tree/master/courses/rust/projects/project-1">PNA Rust Project 1: The Rust toolbox</a>。
</div>
</article>

<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><strong>任务</strong>：在内存中创建一个能够接受命令行参数的键/值存储程序，且程序能够通过一些简单的测试。</p>
<p><strong>目标</strong>：</p>
<ul>
<li>安装Rust编译器和工具</li>
<li>了解本课程中使用的项目结构</li>
<li>使用<code>cargo init</code>/<code>run</code>/<code>test</code>/<code>clippy</code>/<code>fmt</code></li>
<li>了解如何从crates.io查找、导入crates</li>
<li>为键值存储程序定义恰当的数据类型</li>
</ul>
<p><strong>关键词</strong>：测试、<code>clap</code>crate、了解<code>CARGO_VERSION</code>等值、熟悉<code>clippy</code>和<code>rustfmt</code>工具。</p>
<p><strong>扩展练习</strong>：尝试使用<code>structopt</code>crate。</p>
<span id="more"></span>

<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>在这个项目中，您将在内存中创建一个简单的键/值存储，以将字符串映射到字符串，程序能够通过一些简单测试并能够响应命令行参数。项目的重点是熟悉典型Rust 项目的工具链和设置。</p>
<p>即使这些听起来很基础，也请亲手尝试这个项目，因为它将介绍一些会用在整个课程中的通用模式。</p>
<h2 id="项目需求规格"><a href="#项目需求规格" class="headerlink" title="项目需求规格"></a>项目需求规格</h2><p>cargo项目<code>kvs</code>构建了一个名为<code>kvs</code>的命令行键值存储客户端，该客户端又调用了一个名为<code>kvs</code>的库。</p>
<p><code>kvs</code>可执行文件支持以下命令行参数：</p>
<ul>
<li><code>kvs set &lt;KEY&gt; &lt;VALUE&gt;</code><br>将字符串键设置为字符串值</li>
<li><code>kvs get &lt;KEY&gt;</code><br>获取给定字符串键的字符串值</li>
<li><code>kvs rm &lt;KEY&gt;</code><br> 删除给定的键</li>
<li><code>kvs -V</code><br> 打印版本</li>
</ul>
<p><code>kvs</code>库包含一个类型，<code>KvStore</code>，它支持以下方法：</p>
<ul>
<li><code>KvStore::set(&amp;mut self, key: String, value: String)</code><br>将字符串键设置为字符串值</li>
<li><code>KvStore::get(&amp;self, key: String) -&gt; Option&lt;String&gt;</code><br>获取字符串键的字符串值。如果键不存在，返回<code>None</code>。</li>
<li><code>KvStore::remove(&amp;mut self, key: String)</code><br>删除给定的键。</li>
</ul>
<p><code>KvStore</code>类型将值存储在内存中，因此命令行客户端除了打印版本外，能做的并不多。从命令行运行<code>get</code>/<code>set</code>/<code>rm</code>命令时返回”unimplemented”错误。未来项目会将值存储在磁盘上，并实现相应的的命令。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>以您此时的Rust基础应当知道如何使用<a target="_blank" rel="noopener" href="https://www.rustup.rs/">rustup</a>安装Rust。</p>
<p>如果不知道，运行下面的命令即可：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://sh.rustup.rs -sSf | sh</span><br></pre></td></tr></table></figure>

<p>（如果您使用的是Windows，请按照rustup.rs上的说明操作。请注意，您在本课程中将面临比其他人更多的挑战，因为它是在Unix上开发的。通常，在Windows上的Rust开发体验不如在Unix上那么顺滑）。</p>
<p>通过键入<code>rustc -V</code>来验证工具链是否正确安装。如果这不起作用，请注销当前shell的会话并重新登录，以使得安装时的shell profile配置变动可以生效。</p>
<h2 id="项目设置"><a href="#项目设置" class="headerlink" title="项目设置"></a>项目设置</h2><p>您将使用Cargo在git仓库完成本项目。您将从<a target="_blank" rel="noopener" href="https://github.com/pingcap/talent-plan">本课程的源仓库</a>中导入项目的测试用例。</p>
<p>请注意，在源仓库中，与本课程相关的所有内容都在<code>rust</code>子目录中，您可以忽略其他目录。</p>
<p>本课程中的所有项目均包含库和可执行文件。使用可执行文件的形式，是因为我们正在开发一个可以运行的应用程序。使用库的形式，是因为提供的测试用例必须链接到这些库。</p>
<p>在本课程中，我们将为每个项目使用相同的设置。</p>
<p>我们将使用的目录结构为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">├── Cargo.toml</span><br><span class="line">├── src</span><br><span class="line">│   ├── bin</span><br><span class="line">│   │   └── kvs.rs</span><br><span class="line">│   └── lib.rs</span><br><span class="line">└── tests</span><br><span class="line">    └── tests.rs</span><br></pre></td></tr></table></figure>

<p>其中<code>Cargo.toml</code>、<code>lib.rs</code>和<code>kvs.rs</code>文件内容如下：</p>
<p><code>Cargo.toml</code>：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[package]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;kvs&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">authors</span> = [<span class="string">&quot;Brian Anderson &lt;andersrb@gmail.com&gt;&quot;</span>]</span><br><span class="line"><span class="attr">description</span> = <span class="string">&quot;A key-value store&quot;</span></span><br><span class="line"><span class="attr">edition</span> = <span class="string">&quot;2018&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>lib.rs</code>：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// just leave it empty for now</span></span><br></pre></td></tr></table></figure>

<p><code>kvs.rs</code>：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中author应该是您的名字，而name必须是<code>kvs</code>，这是项目名称同时也是库的名称，以使测试用例起作用。同样，二进制文件（命令行应用程序）的名称必须是<code>kvs</code>。在上面的设置中，项目会因文件名隐式地叫做<code>kvs</code>，当然您也可以随意命名文件，只要将适当的信息写入配置文件（<code>Cargo.toml</code>）中即可。</p>
<p>您可以使用<code>cargo new --lib</code>直接新建项目；或使用<code>cargo init --lib</code>在一个空目录中初始化项目；或手动设置这个项目：您可能还需要在同一目录中初始化一个git仓库。</p>
<p>最后，从课程资料中复制<code>tests</code>目录：即将文件<code>rust/projects/project-1/tests</code>从课程仓库复制到您自己的仓库中，也叫做<code>tests</code>。</p>
<p>此时您应该可以使用<code>cargo run</code>运行程序。</p>
<p><em>现在就试试。</em></p>
<p>您已经为这个项目做好了准备，开始编写业务代码吧。</p>
<h2 id="第1部分：编译测试代码"><a href="#第1部分：编译测试代码" class="headerlink" title="第1部分：编译测试代码"></a>第1部分：编译测试代码</h2><p><code>tests/tests.rs</code>中为您提供了一套单元测试。 打开它看看。</p>
<p><em>尝试使用<code>cargo test</code>运行测试。</em>发生了什么？为什么？</p>
<p>本项目的第一个任务是让测试模块能够通过编译。</p>
<p>如果你的项目和我的一样，你应该会看到大量编译错误，我们来看看前几条。通常当你看到一堆错误时，第一条是最重要的 &mdash; <code>rustc</code>会在遇到错误后尝试继续编译，因此后面的可能是级联错误，其意义远低于第一条。您的前几条错误可能如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">error[E0433]: failed to resolve: use of undeclared type or module `assert_cmd`</span><br><span class="line"> --&gt; tests/tests.rs:1:5</span><br><span class="line">  |</span><br><span class="line">1 | use assert_cmd::prelude::*;</span><br><span class="line">  |     ^^^^^^^^^^ use of undeclared type or module `assert_cmd`</span><br><span class="line"></span><br><span class="line">error[E0432]: unresolved import</span><br><span class="line"> --&gt; tests/tests.rs:3:5</span><br><span class="line">  |</span><br><span class="line">3 | use predicates::str::contains;</span><br><span class="line">  |     ^^^^^^^^^^^^^^^^^^^^^^^^^</span><br></pre></td></tr></table></figure>

<p>（如果您看到其他错误，请反馈issue）。</p>
<p>对于一个新的Rust程序员来说，这两个错误很难诊断出来，所以我只会告诉你这里发生了什么：项目配置文件中缺少<a target="_blank" rel="noopener" href="https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html#development-dependencies">开发依赖项</a>的crates。</p>
<p>对于这个项目，你的<code>Cargo.toml</code>文件需要包含这些行：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[dev-dependencies]</span></span><br><span class="line"><span class="attr">assert_cmd</span> = <span class="string">&quot;0.11.0&quot;</span></span><br><span class="line"><span class="attr">predicates</span> = <span class="string">&quot;1.0.0&quot;</span></span><br></pre></td></tr></table></figure>

<p>了解这些依赖项的详情，对您完成本项目并不重要，您可以自己去查找此类信息。我们之前没有告诉您需要开发依赖项，是为了让您自己会遇到这些错误。在未来的项目中，会在项目配置部分告诉您后面所需的开发依赖。</p>
<p>简要说明：您如何确定这些错误是由于项目配置中缺少依赖，项而不是由于源码中的错误造成的？以前面显示的错误为例，一个重要线索：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 | use assert_cmd::prelude::*;</span><br><span class="line">  |     ^^^^^^^^^^ use of undeclared type or module `assert_cmd`</span><br></pre></td></tr></table></figure>

<p>在<code>use</code>语句中，路径中的第一个元素始终是crate的名称。不过，当第一个路径元素引用的，是之前由<em>别的</em><code>use</code>语句引入上下文的名称时，会出现例外情况。换句话说，如果这个文件中有另一个<code>use</code>语句，例如<code>use foo::assert_cmd</code>，那么<code>use assert_cmd::prelude::*</code>中引用的就是<em>之前那个</em><code>assert_cmd</code>。关于这一点还有很多内容，我们就不在这里探讨这些技术细节了。只需要记住，通常在<code>use</code>语句中，如果找不到路径中的第一个元素（即无法解析），问题可能是配置文件中没有声明那个crate。</p>
<p>这是我们在第一个项目中遇到的第一个问题。希望能有所启发。</p>
<p><em>继续，并将适当的开发依赖项添加到您的配置文件中。</em></p>
<p>再次尝试使用<code>cargo test</code>运行测试。发生什么了？为什么？</p>
<p>此时<em>前面的那些</em>错误应该已经消失了。现在的错误应该都是关于测试用例无法在您自己的代码中找到它期望的代码。</p>
<p><em>所以现在您的任务是：声明测试模块编译所需的类型、方法等。</em></p>
<p>在本课程中，您将大量阅读测试用例。测试用例将准确地告诉您对代码的期望。如果书本和实验不一致，则实验为真（纠正错误！）。在编程中也是如此。测试用例展示了软件应有的行为为。测试是现实，应习惯阅读测试用例。</p>
<p>此外，测试用例通常是任何项目中编写质量最差的代码，原始且没有文档注释。</p>
<p>再次尝试使用<code>cargo test</code>运行测试。发生什么了？为什么？</p>
<p>在<code>src/lib.rs</code>中编写能够让<code>cargo test --no-run</code>通过的类和方法签名。暂时不要编写任何函数体&mdash;使用<code>panic!()</code>宏。这是在不知道或不关心实现的情况下描述API的方法（此外还有宏<a target="_blank" rel="noopener" href="https://doc.rust-lang.org/std/macro.unimplemented.html"><code>unimplemented!</code></a>，但由于这个单词有点长，因此通常简单地使用<code>panic!</code>即可。不过，如果您正在发布的软件包含未实现的方法的程序时，则应当使用<code>unimplemented!</code>宏）。</p>
<p>完成上述要求。</p>
<hr>
<p>我的作业：</p>
<figure class="highlight rust"><figcaption><span>src/lib.rs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">KvStore</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> KvStore &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="built_in">panic!</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">get</span></span>(&amp;<span class="keyword">self</span>, k: <span class="built_in">String</span>) -&gt; <span class="built_in">Option</span>&lt;<span class="built_in">String</span>&gt; &#123;</span><br><span class="line">        <span class="built_in">panic!</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">set</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, k: <span class="built_in">String</span>, v: <span class="built_in">String</span>) &#123;</span><br><span class="line">        <span class="built_in">panic!</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">remove</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, k: <span class="built_in">String</span>) &#123;</span><br><span class="line">        <span class="built_in">panic!</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>之后，如果您运行<code>cargo test</code>（不带<code>--no-run</code>），您应该会看到一些测试失败输出，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">    Finished dev [unoptimized + debuginfo] target(s) in 2.32s</span><br><span class="line">     Running target/debug/deps/kvs-b03a01e7008067f6</span><br><span class="line"></span><br><span class="line">running 0 tests</span><br><span class="line"></span><br><span class="line">test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out</span><br><span class="line"></span><br><span class="line">     Running target/debug/deps/kvs-a3b5a004932c6715</span><br><span class="line"></span><br><span class="line">running 0 tests</span><br><span class="line"></span><br><span class="line">test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out</span><br><span class="line"></span><br><span class="line">     Running target/debug/deps/tests-5e1c2e20bd1fa377</span><br><span class="line"></span><br><span class="line">running 13 tests</span><br><span class="line">test cli_get ... FAILED</span><br><span class="line">test cli_invalid_get ... FAILED</span><br><span class="line">test cli_invalid_rm ... FAILED</span><br><span class="line">test cli_invalid_set ... FAILED</span><br><span class="line">test cli_no_args ... FAILED</span><br><span class="line">test cli_invalid_subcommand ... FAILED</span><br><span class="line">... more lines of spew ...</span><br></pre></td></tr></table></figure>

<p>…后还有很多行。太棒了！这结果正是我们现在所需要的。您会在本项目后面的内容中编写让这些测试通过的代码。</p>
<h3 id="测试技巧"><a href="#测试技巧" class="headerlink" title="测试技巧"></a>测试技巧</h3><p>如果你再次查看<code>cargo test</code>的输出，就会看到一些有趣的东西：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">     Running target/debug/deps/kvs-b03a01e7008067f6</span><br><span class="line"></span><br><span class="line">running 0 tests</span><br><span class="line"></span><br><span class="line">test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out</span><br><span class="line"></span><br><span class="line">     Running target/debug/deps/kvs-a3b5a004932c6715</span><br><span class="line"></span><br><span class="line">running 0 tests</span><br><span class="line"></span><br><span class="line">test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out</span><br><span class="line"></span><br><span class="line">     Running target/debug/deps/tests-5e1c2e20bd1fa377</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">running 13 tests</span><br><span class="line">test cli_get ... FAILED</span><br></pre></td></tr></table></figure>

<p>cargo输出了三遍”Running …”。实际上前两次并没有运行任何测试。那么如果这三批测试都没有失败，cargo将运行<em>另一组</em>测试。</p>
<p>为什么会这样？</p>
<p>这是因为在Rust中有很多可以用来编写测试的地方：</p>
<ul>
<li>在库的源码中</li>
<li>在每个二进制的源码中</li>
<li>在每个测试的源码中</li>
<li>在库源码的注释文档中</li>
</ul>
<p>其实cargo并不知道上面这四条里哪些确实包含了测试，cargo只是构建并运行这些测试。</p>
<p>所以这里有两组空测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">     Running target/debug/deps/kvs-b03a01e7008067f6</span><br><span class="line">running 0 tests</span><br><span class="line">     Running target/debug/deps/kvs-a3b5a004932c6715</span><br><span class="line">running 0 tests</span><br></pre></td></tr></table></figure>

<p>不过，这里可能不容易理解：这其中一个是您的库，编译后测试，另一个是您的二进制，编译后测试，目前两者都不包含任何测试。名称中都有”kvs”的原因是因为您的库和二进制文件都称为”kvs”。</p>
<p>这些测试的输出可能有点烦人，有两种方法可以让cargo安静下来：使用命令行参数，或更改项目配置：</p>
<p>以下是相关的命令行标识：</p>
<ul>
<li><code>cargo test --lib</code> &mdash; 只测试库中的测试</li>
<li><code>cargo test --doc</code> &mdash; 测试库中的文档测试</li>
<li><code>cargo test --bins</code> &mdash; 测试项目中的所有二进制</li>
<li><code>cargo test --bin foo</code> &mdash; 只测试<code>foo</code>的二进制</li>
<li><code>cargo test --test foo</code> &mdash; 测试 测试文件<code>foo</code> 中的测试</li>
</ul>
<p>以上命令可以方便快速地隐藏测试输出，但如果项目不包含某种类型的测试，就最好不去处理测试。回想一下The Cargo Book中关于<a target="_blank" rel="noopener" href="https://doc.rust-lang.org/cargo/reference/manifest.html">manifest description</a>的描述，可知有两个配置选项可用：<code>test = false</code>和<code>doctest = false</code>。它们位于[lib]和[[bin]]部分，因此可以考虑更新您的项目配置。</p>
<p>如果以前没用过可以尝试下面这个命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo test -- --help</span><br></pre></td></tr></table></figure>

<p>试试吧，输出很有趣。您在此处看到的是包含已编译测试的可执行文件的帮助信息（由空格包围的<code>--</code>将告诉cargo将之后的所有参数传递给测试二进制文件）。这与运行<code>cargo test --help</code>时显示的信息完全不同。它们是两个不同的命令：cargo在运行您的二进制测试时会将这些参数传递给测试程序。</p>
<p>您也可以通过命令执行同样的操作。让我们再回到的<code>cargo test</code>示例。我们看到了这一行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Running target/debug/deps/kvs-b03a01e7008067f6</span><br></pre></td></tr></table></figure>

<p>这就是cargo告诉您测试二进制的文件名。您可以自己运行它，比如<code>target/debug/deps/kvs-b03a01e7008067f6 --help</code>。</p>
<p><code>target</code>目录里有很多有趣的东西。深入研究可以教会您很多关于Rust工具链工作细节的知识。</p>
<p>在实践中，特别是对于大型项目，您不会在开发单个功能时运行整个测试套件。要将测试集缩小到我们关心的某个测试，请运行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cargo test cli_no_args</span><br></pre></td></tr></table></figure>

<p>这将运行名为<code>cli_no_args</code>的测试。事实上，它会运行名称中包含<code>cli_no_args</code>的任何测试，因此，例如，如果你想运行所有CLI测试，你可以运行<code>cargo test cli</code>。以上可能就是您在完成项目时手动运行测试的各种方式，否则您将被许多尚未修复的失败测试分心。不幸的是，该模式只是一个简单的字符串匹配，而不是像正则表达式那样功能强大的东西。</p>
<p>请注意，在撰写本文时，本课程中项目测试用例，并未按照能够明确指出某测试专为项目的某部分而编写的方式进行组织 - 只是到最后整个测试套件应该通过即可。您需要自己阅读测试的名称和实现，来确定<em>您认为</em>在哪些阶段应该通过哪些测试。</p>
<h2 id="第2部分：接受命令行参数"><a href="#第2部分：接受命令行参数" class="headerlink" title="第2部分：接受命令行参数"></a>第2部分：接受命令行参数</h2><p>本课程中的键/值存取都是通过命令行客户端执行的。在这个项目中，命令行客户端非常简单，因为键值存储的状态只存储在内存中，而不是持久化到磁盘。</p>
<p>通过这一部分，您应使名为<code>cli_*</code>的测试用例通过。</p>
<p>回忆上一部分中介绍的关于如何运行单个测试用例的内容。</p>
<p>重申一下CLI的接口是：</p>
<ul>
<li><code>kvs set &lt;KEY&gt; &lt;VALUE&gt;</code><br>将字符串键设置为字符串值</li>
<li><code>kvs get &lt;KEY&gt;</code><br>获取给定字符串键的字符串值</li>
<li><code>kvs rm &lt;KEY&gt;</code><br> 删除给定的键</li>
<li><code>kvs -V</code><br> 打印版本</li>
</ul>
<p>但在本次迭代中，<code>get</code>和<code>set</code>命令将从stderr输出字符串”unimplemented”，并以非零退出码退出，表示错误。</p>
<p>您可能需要使用<code>clap</code>crate来处理命令行参数。</p>
<p><em>找到最新版本的<code>clap</code>crate 并将其添加到<code>Cargo.toml</code>的依赖项中。</em>有多种方法可以搜索或导入crate，我们推荐：查看内置的<a target="_blank" rel="noopener" href="https://doc.rust-lang.org/cargo/commands/cargo-search.html"><code>cargo search</code></a>和插件<a target="_blank" rel="noopener" href="https://github.com/killercup/cargo-edit"><code>cargo edit</code></a>。</p>
<p>接下来使用<a target="_blank" rel="noopener" href="https://crates.io/">crates.io</a>、<a target="_blank" rel="noopener" href="https://lib.rs/">lib.rs</a>或<a target="_blank" rel="noopener" href="https://docs.rs/">docs.rs</a>查找<code>clap</code>crate 的文档，并实现命令行界面以使名为<code>cli_*</code>的测试用例通过。</p>
<p>测试时，使用<code>cargo run</code>；不要直接从<code>target/</code>目录运行可执行文件。需要将参数传递给程序时，用两个破折号将它们与<code>cargo run</code>命令分开，<code>--</code>，如<code>cargo run -- get key1</code>。</p>
<hr>
<p>我的作业</p>
<figure class="highlight rust"><figcaption><span>kvs.rs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> clap::&#123;Parser, Subcommand&#125;;</span><br><span class="line"><span class="keyword">use</span> std::process::exit;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Parser)]</span></span><br><span class="line"><span class="meta">#[clap(name = <span class="meta-string">&quot;kvs&quot;</span>)]</span></span><br><span class="line"><span class="meta">#[clap(author, version, about=<span class="meta-string">&quot;an in-memory key/value store&quot;</span>, long_about = None)]</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Cli</span></span> &#123;</span><br><span class="line">    <span class="meta">#[clap(subcommand)]</span></span><br><span class="line">    command: Commands,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Subcommand)]</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Commands</span></span> &#123;</span><br><span class="line">    <span class="comment">// Set the value of a string key to a string</span></span><br><span class="line">    <span class="meta">#[clap(arg_required_else_help = true)]</span></span><br><span class="line">    set &#123;</span><br><span class="line">        <span class="comment">// the key of the value to be set</span></span><br><span class="line">        key: <span class="built_in">String</span>,</span><br><span class="line">        <span class="comment">// the value of the key to be set</span></span><br><span class="line">        value: <span class="built_in">String</span>,</span><br><span class="line">    &#125;, </span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the string value of a given string key</span></span><br><span class="line">    <span class="meta">#[clap(arg_required_else_help = true)]</span></span><br><span class="line">    get &#123;</span><br><span class="line">        <span class="comment">// the key wish to query</span></span><br><span class="line">        key: <span class="built_in">String</span>,</span><br><span class="line">    &#125;, </span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove a given key</span></span><br><span class="line">    <span class="meta">#[clap(arg_required_else_help = true)]</span></span><br><span class="line">    rm &#123;</span><br><span class="line">        <span class="comment">// the key wish to remove</span></span><br><span class="line">        key: <span class="built_in">String</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> cli= Cli::parse();</span><br><span class="line">    <span class="keyword">match</span> &amp;cli.command &#123;</span><br><span class="line">        Commands::get &#123; key &#125; =&gt; &#123;</span><br><span class="line">            eprintln!(<span class="string">&quot;unimplemented&quot;</span>);</span><br><span class="line">            exit(<span class="number">1</span>);</span><br><span class="line">        &#125;, </span><br><span class="line">        Commands::set &#123; key, value &#125; =&gt; &#123;</span><br><span class="line">            eprintln!(<span class="string">&quot;unimplemented&quot;</span>);</span><br><span class="line">            exit(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Commands::rm &#123; key &#125; =&gt; &#123;</span><br><span class="line">            eprintln!(<span class="string">&quot;unimplemented&quot;</span>);</span><br><span class="line">            exit(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="第3部分：cargo环境变量"><a href="#第3部分：cargo环境变量" class="headerlink" title="第3部分：cargo环境变量"></a>第3部分：cargo环境变量</h2><p>当您设置<code>clap</code>来解析命令行参数时，您可能会设置名称、版本、作者和描述（如果没有，请这样做）。这些是<code>Cargo.toml</code>提供的冗余信息，而这些Cargo在构建时设置的环境变量可以被Rust源码访问。</p>
<p><em>修改您的<code>clap</code>设置以从cargo标准环境变量中设置这些值。</em></p>
<h2 id="第4部分：将值存储在内存中"><a href="#第4部分：将值存储在内存中" class="headerlink" title="第4部分：将值存储在内存中"></a>第4部分：将值存储在内存中</h2><p>您的命令行程序已经有了雏形，现在让我们实现<code>KvStore</code>，以使得其余的测试用例通过。</p>
<p>通过阅读测试用例即可了解<code>KvStore</code>方法的行为 &mdash; 您不需要任何进一步的描述来完成这个项目的代码。</p>
<p><em>通过在<code>KvStore</code>上实现各方法使其余的测试用例通过。</em></p>
<hr>
<p>我的作业：</p>
<figure class="highlight rust"><figcaption><span>lib.rs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">KvStore</span></span> &#123;</span><br><span class="line">    db: HashMap&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> KvStore &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        KvStore &#123; db: HashMap::new() &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">get</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, k: <span class="built_in">String</span>) -&gt; <span class="built_in">Option</span>&lt;<span class="built_in">String</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span>.db.remove(&amp;k)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">set</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, k: <span class="built_in">String</span>, v: <span class="built_in">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.db.insert(k, v);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">remove</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, k: <span class="built_in">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.db.remove(&amp;k);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="第5部分：文档"><a href="#第5部分：文档" class="headerlink" title="第5部分：文档"></a>第5部分：文档</h2><p>您已经实现了项目的功能，但是在它成为一个优秀的Rust软件之前我们还需要做一些事情，以准备好贡献或发布。</p>
<p>首先，公共项目通常应该有文档注释。</p>
<p>文档注释显示在crate的API文档中。使用命令<code>cargo doc</code>生成API文档，这可以将文档注释渲染为HTML并放在<code>target/doc</code>文件夹中。请注意，尽管<code>target/doc</code>文件夹不包含<code>index.html</code>。在本项目中，您的crate文档将位于<code>target/doc/kvs/index.html</code>。您可以使用<code>cargo doc --open</code>在该位置启动Web浏览器。<code>cargo doc --open</code>并不总是有效，比如，如果您通过<code>ssh</code>连接到云实例就无法打开。不过就算打不开浏览器，该命令仍将打印它无法打开的html的文件名 &mdash; 这会方便我们查找API文档的位置。</p>
<p><a target="_blank" rel="noopener" href="https://rust-lang-nursery.github.io/api-guidelines/documentation.html">好的文档注释</a>并不是是重复函数名，也不是重复从类型签名中收集到的信息。好的注释应该解释为什么以及如何使用函数，成功和失败时的返回值是什么，什么条件会触发error和panic。您编写的库非常简单，因此文档也会很简单。如果您真的想不出通过文档注释添加任何有用的内容，那么可以不添加文档注释（这是一个偏好问题）。在没有文档注释的情况下，仅从名称和类型签名就应该清楚如何使用类型或函数。</p>
<p>文档注释可以包含示例，而这些示例可以使用<code>cargo test --doc</code>进行测试。</p>
<p>将<code>#![deny(missing_docs)]</code>添加到<code>src/lib.rs</code>的顶部以强制所有公共项都具有文档注释。然后向您已经实现的类型和方法中添加文档注释，编写注释时请遵循<a target="_blank" rel="noopener" href="https://rust-lang-nursery.github.io/api-guidelines/documentation.html">文档指南</a>。给每个函数一个例子，并确保他们通过<code>cargo test --doc</code>。</p>
<hr>
<p>我的作业：</p>
<figure class="highlight rust"><figcaption><span>lib.rs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#![deny(missing_docs)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//!</span></span><br><span class="line"><span class="comment">//! An in-memory key/value store.</span></span><br><span class="line"><span class="comment">//! Use hashmap to implement the get, set, remove behavior</span></span><br><span class="line"><span class="comment">//! </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// `KvStore` structure contain a Hashmap as member `db` for manipulate key/values in memory.</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">KvStore</span></span> &#123;</span><br><span class="line">    db: HashMap&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> KvStore &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// create a `KvStore`, initial an empty HashMap for member `db`.</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        KvStore &#123; db: HashMap::new() &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Query HashMap in `KvStore` using key `key`.</span></span><br><span class="line">    <span class="comment">/// If the map did have this key present, get the corresponding `value` and return `Some(value)`. </span></span><br><span class="line">    <span class="comment">/// If the map did not have this key present, return `None`.</span></span><br><span class="line">    <span class="comment">/// </span></span><br><span class="line">    <span class="comment">/// # Example</span></span><br><span class="line">    <span class="comment">/// </span></span><br><span class="line">    <span class="comment">/// ```rust</span></span><br><span class="line">    <span class="comment">/// use kvs::KvStore;</span></span><br><span class="line">    <span class="comment">/// </span></span><br><span class="line">    <span class="comment">/// let mut store = KvStore::new();</span></span><br><span class="line">    <span class="comment">/// store.set(&quot;key1&quot;.to_owned(), &quot;value1&quot;.to_owned());</span></span><br><span class="line">    <span class="comment">/// assert_eq!(store.get(&quot;key1&quot;.to_owned()), Some(&quot;value1&quot;.to_owned()));</span></span><br><span class="line">    <span class="comment">/// assert_eq!(store.get(&quot;key2&quot;.to_owned()), None);</span></span><br><span class="line">    <span class="comment">/// ```</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">get</span></span>(&amp;<span class="keyword">self</span>, key: <span class="built_in">String</span>) -&gt; <span class="built_in">Option</span>&lt;<span class="built_in">String</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span>.db.get(&amp;key) &#123;</span><br><span class="line">            <span class="literal">Some</span>(value) =&gt; <span class="literal">Some</span>(value.to_string()),</span><br><span class="line">            <span class="literal">None</span> =&gt; <span class="literal">None</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/// Update HashMap in `KvStore` using key/value pair `key` and `value`.</span></span><br><span class="line">    <span class="comment">/// If the map did not have this key present, insert `key` with `value`.</span></span><br><span class="line">    <span class="comment">/// If the map did have this key present, the value is updated.</span></span><br><span class="line">    <span class="comment">/// </span></span><br><span class="line">    <span class="comment">/// # Example</span></span><br><span class="line">    <span class="comment">/// </span></span><br><span class="line">    <span class="comment">/// ```rust</span></span><br><span class="line">    <span class="comment">/// use kvs::KvStore;</span></span><br><span class="line">    <span class="comment">/// </span></span><br><span class="line">    <span class="comment">/// let mut store = KvStore::new();</span></span><br><span class="line">    <span class="comment">/// </span></span><br><span class="line">    <span class="comment">/// store.set(&quot;key1&quot;.to_owned(), &quot;value1&quot;.to_owned());</span></span><br><span class="line">    <span class="comment">/// assert_eq!(store.get(&quot;key1&quot;.to_owned()), Some(&quot;value1&quot;.to_owned()));</span></span><br><span class="line">    <span class="comment">/// store.set(&quot;key1&quot;.to_owned(), &quot;value2&quot;.to_owned());</span></span><br><span class="line">    <span class="comment">/// assert_eq!(store.get(&quot;key1&quot;.to_owned()), Some(&quot;value2&quot;.to_owned()));</span></span><br><span class="line">    <span class="comment">/// ```</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">set</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, key: <span class="built_in">String</span>, value: <span class="built_in">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.db.insert(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Removes the key `key` from HashMap in `KvStore`.</span></span><br><span class="line">    <span class="comment">/// </span></span><br><span class="line">    <span class="comment">/// # Example</span></span><br><span class="line">    <span class="comment">/// </span></span><br><span class="line">    <span class="comment">/// ```rust</span></span><br><span class="line">    <span class="comment">/// use kvs::KvStore;</span></span><br><span class="line">    <span class="comment">/// let mut store = KvStore::new();</span></span><br><span class="line">    <span class="comment">/// </span></span><br><span class="line">    <span class="comment">/// store.set(&quot;key1&quot;.to_owned(), &quot;value1&quot;.to_owned());</span></span><br><span class="line">    <span class="comment">/// store.remove(&quot;key1&quot;.to_owned());</span></span><br><span class="line">    <span class="comment">/// assert_eq!(store.get(&quot;key1&quot;.to_owned()), None);</span></span><br><span class="line">    <span class="comment">/// ```</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">remove</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, key: <span class="built_in">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.db.remove(&amp;key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="第6部分：使用clippy和rustfmt规范代码"><a href="#第6部分：使用clippy和rustfmt规范代码" class="headerlink" title="第6部分：使用clippy和rustfmt规范代码"></a>第6部分：使用<code>clippy</code>和<code>rustfmt</code>规范代码</h2><p><a target="_blank" rel="noopener" href="https://github.com/rust-lang/rust-clippy"><code>clippy</code></a>和<a target="_blank" rel="noopener" href="https://github.com/rust-lang/rustfmt"><code>rustfmt</code></a>是规范Rust代码的工具。<code>clippy</code>有助于确保代码风格符合规范，也能够检查出一些可能产生错误的编程模式。<code>rustfmt</code>会强制代码格式保持一致。在您有空的时候可以单击这些链接并阅读它们的文档。这些都是较为复杂的工具，功能远不止文中所述。</p>
<p>这两个工具都包含在Rust工具链中，但默认情况下不安装。可以使用以下<code>rustup</code>命令进行安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rustup component add clippy</span><br><span class="line">rustup component add rustfmt</span><br></pre></td></tr></table></figure>

<p>现在就试试吧。</p>
<p>这两个工具均以cargo子命令的形式调用，<code>clippy</code>使用<code>cargo clippy</code>、<code>rustfmt</code>使用<code>cargo fmt</code>调用。请注意，<code>cargo fmt</code>会修改您的源代码，因此请在运行之前提交您的工作，以避免产生意料之外的非必要修改，之后您可以再使用<code>git commit --amend</code>将更改作为先前提交的一部分包含在内。或者只是将它们作为自己的格式化提交 &mdash; 对于Rust来说，在一系列提交之后进行<code>clippy</code>和<code>rustfmt</code>是很常见的，比如在提交一个pull request前。</p>
<p><em>在您的项目上执行<code>cargo clippy</code>并按照建议修改代码。在您的项目上执行<code>cargo fmt</code>并提交所有更改。</em></p>
<p>建议阅读<a target="_blank" rel="noopener" href="https://github.com/rust-lang/rustup.rs/blob/master/README.md"><code>rustup</code></a>、<a target="_blank" rel="noopener" href="https://github.com/rust-lang/rust-clippy"><code>clippy</code></a>和<a target="_blank" rel="noopener" href="https://github.com/rust-lang/rustfmt"><code>rustfmt</code></a>文档，因为这些是您经常会用到的工具。</p>
<p>恭喜，您完成了你的第一个项目！如果您愿意，还可以试着完成下面的扩展作业，扩展作业是可选的。</p>
<p>此外，还可以使用下面的命令探索Rust工具链：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rustup component list</span><br><span class="line">rustup component list | rg -v std # ripgrep，一个用rust编写的grep替代，`-v`即反向匹配</span><br></pre></td></tr></table></figure>

<p>干得漂亮，同学，休息一下吧。</p>
<h2 id="扩展1：structopt"><a href="#扩展1：structopt" class="headerlink" title="扩展1：structopt"></a>扩展1：<code>structopt</code></h2><p>在这个项目中，我们使用<code>clap</code>来解析命令行参数。通常将程序已解析的命令行参数表示为一个结构体，比如叫做<code>Config</code>或<code>Options</code>。这就需要调用<code>clap</code>的 <code>ArgMatches</code>类型上的相应方法。对于较大的程序，这两个步骤都需要大量模板化的代码。<code>structopt</code>crate能够让您定义一个可以自动生成并注释<code>clap</code>命令行解释器的<code>Config</code>结构体，来大幅减少这些模板化代码。一些人发现使用这种方式，比显式编写<code>clap</code>代码更方便。</p>
<p>修改您的程序以使用<code>structopt</code>来解析命令行参数，而不是直接使用<code>clap</code>。</p>
<hr>
<p>我的作业：</p>
<p>由于我在2022年3月初完成的作业，所以在我的<code>Cargo.toml</code>中声明的<code>clap</code>依赖已经具备了<code>derive</code>这一新特性。</p>
<figure class="highlight toml"><figcaption><span>Cargo.toml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">clap</span> = &#123; version = <span class="string">&quot;3.1.5&quot;</span>, features = [<span class="string">&quot;derive&quot;</span>] &#125;</span><br></pre></td></tr></table></figure>

<p>而<code>derive</code>特性就是装饰在某结构体上，通过宏给该结构体隐式实现各种功能。因此不再需要编写<code>ArgMatches</code>的相应方法，也不再需要使用<code>structopt</code>简化实现了：</p>
<figure class="highlight plaintext"><figcaption><span>kvs.rs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">use clap::&#123;Parser, Subcommand&#125;;</span><br><span class="line">use std::process::exit;</span><br><span class="line"></span><br><span class="line">#[derive(Parser)]</span><br><span class="line">//...</span><br><span class="line">struct Cli &#123;</span><br><span class="line">    #[clap(subcommand)]</span><br><span class="line">    command: Commands,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#[derive(Subcommand)]</span><br><span class="line">enum Commands &#123;</span><br><span class="line">//...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>通过测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">running 0 tests</span><br><span class="line"></span><br><span class="line">test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s</span><br><span class="line"></span><br><span class="line">     Running unittests (target/debug/deps/kvs-8750b5b96d05456c)</span><br><span class="line"></span><br><span class="line">running 0 tests</span><br><span class="line"></span><br><span class="line">test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s</span><br><span class="line"></span><br><span class="line">     Running tests/tests.rs (target/debug/deps/tests-2241116061e67a21)</span><br><span class="line"></span><br><span class="line">running 13 tests</span><br><span class="line">test cli_get ... ok</span><br><span class="line">test cli_invalid_subcommand ... ok</span><br><span class="line">test cli_rm ... ok</span><br><span class="line">test cli_set ... ok</span><br><span class="line">test cli_no_args ... ok</span><br><span class="line">test get_non_existent_value ... ok</span><br><span class="line">test get_stored_value ... ok</span><br><span class="line">test remove_key ... ok</span><br><span class="line">test overwrite_value ... ok</span><br><span class="line">test cli_version ... ok</span><br><span class="line">test cli_invalid_get ... ok</span><br><span class="line">test cli_invalid_rm ... ok</span><br><span class="line">test cli_invalid_set ... ok</span><br><span class="line"></span><br><span class="line">test result: ok. 13 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.35s</span><br><span class="line"></span><br><span class="line">   Doc-tests kvs</span><br><span class="line"></span><br><span class="line">running 3 tests</span><br><span class="line">test src/lib.rs - KvStore::set (line 46) ... ok</span><br><span class="line">test src/lib.rs - KvStore::get (line 28) ... ok</span><br><span class="line">test src/lib.rs - KvStore::remove (line 64) ... ok</span><br><span class="line"></span><br><span class="line">test result: ok. 3 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 1.18s</span><br></pre></td></tr></table></figure>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Rust/">Rust</a></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><div class="social-share"></div><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/alipay.jpg" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/wechatpay.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/03/11/pna-rust-project-2/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">PingCap的Rust训练课程2：日志结构文件I/O</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2022/02/10/rust-write-a-good-cli-program/"><span class="level-item">使用rust编写高质量命令行程序</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><script src="https://utteranc.es/client.js" repo="zlotus/comment" issue-term="pathname" label="some-issue-label" theme="github-light" crossorigin="anonymous" async></script></div></div></div><div class="column column-left is-3-tablet is-3-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/opm_sq.png" alt="子实"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">子实</p><p class="is-size-6 is-block">程序员</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>陕西/西安</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">78</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">22</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/zlotus" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/zlotus"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com/qinzishi"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/Zealot_uS"><i class="fab fa-twitter"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://www.zhihu.com/people/zlotus" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">知乎</span></span><span class="level-right"><span class="level-item tag">www.zhihu.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Diary/"><span class="level-start"><span class="level-item">Diary</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">64</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Shell/"><span class="level-start"><span class="level-item">Shell</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Coroutines/"><span class="tag">Coroutines</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaScript/"><span class="tag">JavaScript</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Javascript/"><span class="tag">Javascript</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">30</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenCV/"><span class="tag">OpenCV</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Operating-System/"><span class="tag">Operating System</span><span class="tag">21</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Paper/"><span class="tag">Paper</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Raspberry-Pi/"><span class="tag">Raspberry Pi</span><span class="tag">20</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Rust/"><span class="tag">Rust</span><span class="tag">29</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Shell/"><span class="tag">Shell</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TensorFlow/"><span class="tag">TensorFlow</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tokio/"><span class="tag">Tokio</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ZMQ/"><span class="tag">ZMQ</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ctpn/"><span class="tag">ctpn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/obsidion/"><span class="tag">obsidion</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%97%A5%E8%AE%B0/"><span class="tag">日记</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9D%82%E8%B0%88/"><span class="tag">杂谈</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%AE%97%E6%B3%95/"><span class="tag">算法</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BC%96%E7%A8%8B/"><span class="tag">编程</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%84%9A%E6%9C%AC/"><span class="tag">脚本</span><span class="tag">4</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/opm_sq.png" alt="子实" height="28"></a><p class="is-size-7"><span>&copy; 2023 子实</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>