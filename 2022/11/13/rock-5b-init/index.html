<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>radxa Rock 5b使用体验 - 子实</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="子实"><meta name="msapplication-TileImage" content="/img/avatar-o.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="子实"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="2022双十一闲鱼通过使用热心老哥-400¥的优惠券下单988到手の使用初体验"><meta property="og:type" content="article"><meta property="og:title" content="radxa Rock 5b使用体验"><meta property="og:url" content="https://zlotus.github.io/2022/11/13/rock-5b-init/"><meta property="og:site_name" content="子实"><meta property="og:description" content="2022双十一闲鱼通过使用热心老哥-400¥的优惠券下单988到手の使用初体验"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://zlotus.github.io/img/og_image.png"><meta property="article:published_time" content="2022-11-13T10:52:00.000Z"><meta property="article:modified_time" content="2023-02-18T16:00:09.000Z"><meta property="article:author" content="子实"><meta property="article:tag" content="Linux"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><meta property="twitter:creator" content="@Zealot_uS"><meta property="twitter:site" content="Zealot_uS"><link rel="publisher" href="+LotusQin"><meta property="fb:admins" content="qinzishi"><meta property="fb:app_id" content="qinzishi"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://zlotus.github.io/2022/11/13/rock-5b-init/"},"headline":"radxa Rock 5b使用体验","image":["https://zlotus.github.io/img/og_image.png"],"datePublished":"2022-11-13T10:52:00.000Z","dateModified":"2023-02-18T16:00:09.000Z","author":{"@type":"Person","name":"子实"},"publisher":{"@type":"Organization","name":"子实","logo":{"@type":"ImageObject","url":"https://zlotus.github.io/img/opm_sq.png"}},"description":"2022双十一闲鱼通过使用热心老哥-400¥的优惠券下单988到手の使用初体验"}</script><link rel="icon" href="/img/avatar-o.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><!--!--><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/opm_sq.png" alt="子实" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/2014/07/09/about-me/">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/zlotus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-9-tablet is-9-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-11-13T10:52:00.000Z" title="11/13/2022, 6:52:00 PM">2022-11-13</time>发表</span><span class="level-item"><time dateTime="2023-02-18T16:00:09.000Z" title="2/19/2023, 12:00:09 AM">2023-02-19</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Programming/">Programming</a></span><span class="level-item">1 小时读完 (大约11031个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">radxa Rock 5b使用体验</h1><div class="content"><p>今年双十一最大战果，就是通过radxa的QQ群找了个热心大哥，60¥买了他-400¥的券，下单了ROCK 5b裸板，昨天到货后我就迫不及待地去单位对面的顺丰网点自提了。回家因为没有HDMI显示器（家里甚至没电视），就用SSH+VNC进行了初体验，后来为这个板子专门买了台4K显示器，谁是椟谁是珠我都快搞不清了……</p>
<span id="more"></span>

<h2 id="烧录镜像"><a href="#烧录镜像" class="headerlink" title="烧录镜像"></a>烧录镜像</h2><p>我选用了官方提供的debian 11，在<a target="_blank" rel="noopener" href="https://github.com/radxa/debos-radxa/releases/latest">release</a>里选了<a target="_blank" rel="noopener" href="https://github.com/radxa/debos-radxa/releases/download/20221111-1029/rock-5b-debian-bullseye-xfce4-arm64-20221111-1506-gpt.img.xz">rock-5b-debian-bullseye-xfce4-arm64-20221111-1506-gpt.img.xz</a>镜像，按照<a target="_blank" rel="noopener" href="https://wiki.radxa.com/Rock5/install/microSD">教程</a>像树莓派一样用balenaEtcher烧录进TF卡中（使用TF卡是因为买不起emmc）。</p>
<p>后来摸索发现Armbian也挺好用，但是<a target="_blank" rel="noopener" href="https://www.armbian.com/rock-5b/">23版本</a>一线通有问题，暂时使用<a target="_blank" rel="noopener" href="http://xogium.performanceservers.nl/archive/rock-5b/archive/">22版本</a>。如果把系统装在emmc上，就可以使用显示器反向充电一线通，据说tf卡速度不够pd协商过不去会不停重启。按照<a target="_blank" rel="noopener" href="https://wiki.radxa.com/Rock5/install/usb-install-emmc">官方教程</a>将系统烧录到emmc中。</p>
<h2 id="安装风扇自动控制"><a href="#安装风扇自动控制" class="headerlink" title="安装风扇自动控制"></a>安装风扇自动控制</h2><p>淘宝了个5v/5.5cm孔距/1.25接口的北桥风扇，一开始插上去运行风扇测试脚本<code>sudo test_fan_run.sh</code>不转（手拨一下才转），万用表测FAN输出4.87V，将脚本里的PWM占空参数调整为9000/10000后风扇起码跑起来了，再减下去依然能跑。网上有大佬写了<a target="_blank" rel="noopener" href="https://github.com/pymumu/fan-control-rock5b/releases/">自动控制风扇的程序</a>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install lm-sensors</span><br><span class="line"></span><br><span class="line">sudo ip route add 0.0.0.0/0 via 192.168.1.150 dev wlan0 proto static</span><br><span class="line">wget https://github.com/pymumu/fan-control-rock5b/releases/download/1.1.0/fan-control-rock5b.1.1.0.arm64.deb</span><br><span class="line">sudo ip route delete default via 192.168.1.150 dev wlan0 proto static</span><br><span class="line">sudo apt install ./fan-control-rock5b.1.1.0.arm64.deb</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> fan-control</span><br><span class="line">sudo systemctl start fan-control</span><br><span class="line">sudo systemctl status fan-control</span><br></pre></td></tr></table></figure>

<h2 id="正确设置WiFi和蓝牙"><a href="#正确设置WiFi和蓝牙" class="headerlink" title="正确设置WiFi和蓝牙"></a>正确设置WiFi和蓝牙</h2><p>根据<a target="_blank" rel="noopener" href="https://wiki.radxa.com/Rock5/linux/debian#wifi-connection">官方指南</a>关于蓝牙的描述，如果使用RTL8852BE的蓝牙，需要修改黑名单设置才能让蓝牙正常工作：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/modprobe.d/blacklist.conf</span><br><span class="line">blacklist pgdrv</span><br><span class="line">blacklist btusb</span><br><span class="line">blacklist btrtl</span><br><span class="line">blacklist btbcm</span><br><span class="line">blacklist btintel</span><br></pre></td></tr></table></figure>

<p>在Armbian中，RTL8852BE网卡总会被认成两块MAC不同适配器，而且在启动时<code>dmesg</code>显示其中一块网卡会被重命名为<code>wlP2p33s0</code>，另一块可能叫做<code>wlan0</code>也可能叫做<code>wlan1</code>，这导致<code>wlP2p33s0</code>的MAC地址可能是<code>14:xx:xx:xx:xx:xx</code>也可能是<code>16:xx:xx:xx:xx:xx</code>，自动连接WiFi时不确定会先由哪个网卡连上，在IP-MAC绑定时就无法确定下一次连接上的IP是多少。临时的解决方法是<a target="_blank" rel="noopener" href="https://ubuntu-mate.community/t/something-is-renaming-my-eth0-and-wlan0-interfaces/2884/8">禁止系统重命名设备</a>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /dev/null /etc/udev/rules.d/80-net-setup-link.rules</span><br></pre></td></tr></table></figure>

<p>重启后<code>wlan0</code>将会确定为<code>14:xx:xx:xx:xx:xx</code>，<code>wlan1</code>将会确定为<code>16:xx:xx:xx:xx:xx</code>。网上有一些<a target="_blank" rel="noopener" href="https://www.reddit.com/r/pihole/comments/q53i1h/why_might_a_device_have_two_ip_and_mac_addresses/">猜测</a>认为这种现象可能是双模WiFi网卡引起的。使用<code>iw dev</code>确实能看到是同一块物理设备下产生的两个适配器，<code>iw phy phy0 info</code>虽然能看到设备的详细信息，但是完全看不懂……</p>
<h2 id="更新设备并获取GPU支持"><a href="#更新设备并获取GPU支持" class="headerlink" title="更新设备并获取GPU支持"></a>更新设备并获取GPU支持</h2><p>按照<a target="_blank" rel="noopener" href="https://www.armbian.com/rock-5b/">Armbian官方说明</a>添加大佬的源，以更新GPU驱动</p>
<p>如果在<code>/lib/firmware/</code>下没有<code>mali_csffw.bin</code>，就去下载一个<code>sudo curl -o /lib/firmware/mali_csffw.bin https://github.com/JeffyCN/rockchip_mirrors/blob/libmali/firmware/g610/mali_csffw.bin</code>。</p>
<p>镜像中如果有不需要的软件，如libreoffice，可以先卸掉在配置系统，以避免不必要的升级。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">sudo ip route add 0.0.0.0/0 via 192.168.1.150 dev wlan0 proto static</span><br><span class="line">sudo add-apt-repository ppa:liujianfeng1994/panfork-mesa</span><br><span class="line">sudo add-apt-repository ppa:liujianfeng1994/rockchip-multimedia</span><br><span class="line">sudo ip route delete default via 192.168.1.150 dev wlan0 proto static</span><br><span class="line"></span><br><span class="line">sudo apt remove --purge libreoffice\* thunderbird\* codium pidgin</span><br><span class="line">sudo apt remove --purge thunderbird\*</span><br><span class="line">sudo apt remove --purge codium</span><br><span class="line">sudo apt remove --purge pidgin</span><br><span class="line"><span class="comment"># # 卸载自带的chromium，装大神的GPU加速版，卸载其他不需要的软件</span></span><br><span class="line"><span class="comment"># sudo apt remove chromium-\*</span></span><br><span class="line"></span><br><span class="line">sudo apt-get clean</span><br><span class="line">sudo apt-get autoremove</span><br><span class="line"></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt list --upgradable</span><br><span class="line"><span class="comment">#sudo apt dist-upgrade # 是否升级要斟酌，armbian22-&gt;23后，pd有问题，无法一线通，还可能需要诱骗。</span></span><br><span class="line"></span><br><span class="line">sudo apt install rockchip-multimedia-config</span><br><span class="line"></span><br><span class="line"><span class="comment"># sudo curl -o /lib/firmware/mali_csffw.bin https://github.com/JeffyCN/rockchip_mirrors/blob/libmali/firmware/g610/mali_csffw.bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sudo vim /etc/udev/rules.d/11-rockchip-multimedia.rules</span></span><br><span class="line"><span class="comment"># KERNEL==&quot;mpp_service&quot;, MODE=&quot;0660&quot;, GROUP=&quot;video&quot;</span></span><br><span class="line"><span class="comment"># KERNEL==&quot;rga&quot;, MODE=&quot;0660&quot;, GROUP=&quot;video&quot;</span></span><br><span class="line"><span class="comment"># KERNEL==&quot;system-dma32&quot;, MODE=&quot;0666&quot;, GROUP=&quot;video&quot;</span></span><br><span class="line"><span class="comment"># KERNEL==&quot;system-uncached-dma32&quot;, MODE=&quot;0666&quot;, GROUP=&quot;video&quot; RUN+=&quot;/usr/bin/chmod a+rw /dev/dma_heap&quot;</span></span><br><span class="line"></span><br><span class="line">sudo apt install kodi</span><br><span class="line"></span><br><span class="line">sudo mv /usr/share/xsessions/kodi.desktop /usr/share/wayland-sessions/kodi-wayland.desktop</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://linuxconfig.org/how-to-enable-disable-wayland-on-ubuntu-22-04-desktop">如何启用/停用wayland桌面</a></li>
<li><a target="_blank" rel="noopener" href="https://forum.radxa.com/t/rk3588-kodi-rkmpp-accelerated-decoding-working-out-of-box/12785">硬解相关</a></li>
<li><a target="_blank" rel="noopener" href="https://forum.armbian.com/topic/24802-kodi-for-rk35xx-510-legacy-kernel">kodi安装的详细过程</a></li>
</ul>
<p>Armbian进系统选用户和桌面环境的界面叫<code>lightdm-slick-greeter</code>，桌面环境列表来自<code>/usr/share/xsessions/*.desktop</code>和<code>/usr/share/wayland-session/*.desktop</code>，如果列表里面有不需要的项目可以将<code>*.desktop</code>改为<code>*.desktop.bak</code>之类的名字。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo mv /usr/share/xsessions/gnome-xorg.desktop /usr/share/xsessions/gnome-xorg.desktop.bak</span><br><span class="line">sudo mv /usr/share/xsessions/gnome.desktop /usr/share/xsessions/gnome.desktop.bak</span><br><span class="line">sudo mv /usr/share/xsessions/ubuntu-xorg.desktop /usr/share/xsessions/ubuntu-xorg.desktop.bak</span><br><span class="line">sudo mv /usr/share/xsessions/ubuntu.desktop /usr/share/xsessions/ubuntu.desktop.bak</span><br><span class="line"></span><br><span class="line">sudo mv /usr/share/wayland-sessions/gnome.desktop /usr/share/wayland-sessions/gnome.desktop.bak</span><br><span class="line">sudo mv /usr/share/wayland-sessions/ubuntu.desktop /usr/share/wayland-sessions/ubuntu.desktop.bak</span><br></pre></td></tr></table></figure>

<p>可以使用<code>lightdm --show-config</code>查看lightdm各项配置来源，一些配置项可以参考<a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/LightDM">LightDM - ArchWiki</a>、<a target="_blank" rel="noopener" href="https://wiki.ubuntu.com/LightDM">LightDM - UbuntuWiki</a>、<a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Display_manager#Session_configuration">Display manager - ArchWiki</a>。其中，默认桌面环境可以在<code>/etc/lightdm/lightdm.conf.d/11-armbian.conf</code>中添加<code>user-session=ubuntu-wayland</code>。此外，可以用<code>lightdm-settings</code>以GUI的方式改登录时候的背景之类的东西。</p>
<ul>
<li>注意，更新Armbian23.02后，PD一线通会无限重启，官方建议诱骗。之后重新下载了<a target="_blank" rel="noopener" href="https://armbian.tnahosting.net/archive/rock-5b/archive/">旧版</a>Armbian_22.1.2，然后单独升级<code>armbian-firmware</code>，并安装大佬ppa中的所有包，在更新gnome相关的包，断电重启进wayland恢复正常。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install armbian-firmware</span><br><span class="line"></span><br><span class="line">sudo apt install libgl4es libdri2to3 libmali-g610-x11 malirun mali-g610-firmware libd3dadapter9-mesa libegl-mesa0 libegl1-mesa libgbm1 libgl1-mesa-dri libgl1-mesa-glx libglapi-mesa libgles2-mesa libglx-mesa0 libosmesa6 libwayland-egl1-mesa mesa-opencl-icd mesa-va-drivers mesa-vdpau-drivers mesa-vulkan-drivers</span><br><span class="line"></span><br><span class="line">sudo apt install gnome-control-center-data gnome-control-center gnome-remote-desktop language-selector-gnome</span><br></pre></td></tr></table></figure>

<p>其他的参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://launchpad.net/~liujianfeng1994/+archive/ubuntu/panfork-mesa">大佬JianFeng Liu的源</a></li>
<li><a target="_blank" rel="noopener" href="https://raspberrypi.stackexchange.com/questions/10452/vncviewer-fonts">x11vnc</a>相关</li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/42296329/how-to-properly-configure-xstartup-file-for-tightvnc-with-ubuntu-vps-gnome-envir">tightvnc</a>相关</li>
</ul>
<h2 id="基础设置"><a href="#基础设置" class="headerlink" title="基础设置"></a>基础设置</h2><p><a target="_blank" rel="noopener" href="https://wiki.radxa.com/Rock5/linux/debian">手册</a>上说SSH默认用户名密码是<code>rock/rock</code>，就直接进去了。进去以后执行命令是不是报语言环境的相关警告，就安装一下语言包，这个镜像默认没有装<code>locales</code>，得自己手动安装。</p>
<p>双十一买到手时，Armbian只有民间支持没有官方支持，Radxa官方只有debian和ubuntu，经过我一个多月的把玩，还是觉得Armbian好用。另外，十二月Armbian也官方也有了支持，因此建议直接用Armbian。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用`free -m`检测虚拟内存，若有则关闭，5b的16G版本内存绰绰有余</span></span><br><span class="line">sudo swapoff -a</span><br><span class="line"><span class="comment"># 修改虚拟内存优先级到`0`</span></span><br><span class="line">sudo sysctl vm.swappiness=0</span><br><span class="line">sudo vim /etc/sysctl.conf</span><br><span class="line">vm.swappiness=0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是电口，就是`enP4p65s0`</span></span><br><span class="line">ip route list</span><br><span class="line">default via 192.168.1.1 dev enP4p65s0 proto dhcp metric 100</span><br><span class="line">192.168.1.0/24 dev enP4p65s0 proto kernel scope link src 192.168.1.120 metric 100</span><br><span class="line"><span class="comment"># 添加一条默认路由到OpenWRT，更新会快一些</span></span><br><span class="line">sudo ip route add 0.0.0.0/0 via 192.168.1.150 dev enP4p65s0 proto static</span><br><span class="line"><span class="comment"># 删除该默认路由</span></span><br><span class="line">sudo ip route delete default via 192.168.1.150 dev enP4p65s0 proto static</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果是RTL8852BE无线网卡，就是`wlP2p33s0`</span></span><br><span class="line">ip route list</span><br><span class="line">default via 192.168.1.1 dev wlP2p33s0 proto dhcp metric 100</span><br><span class="line">192.168.1.0/24 dev wlP2p33s0 proto kernel scope link src 192.168.1.120 metric 100</span><br><span class="line"><span class="comment"># 添加一条默认路由到OpenWRT</span></span><br><span class="line">sudo ip route add 0.0.0.0/0 via 192.168.1.150 dev wlP2p33s0 proto static</span><br><span class="line"><span class="comment">#sudo ip route add 0.0.0.0/0 via 192.168.1.150 dev wlan0 proto static</span></span><br><span class="line"><span class="comment"># 删除该默认路由</span></span><br><span class="line">sudo ip route delete default via 192.168.1.150 dev wlP2p33s0 proto static</span><br><span class="line"><span class="comment">#sudo ip route delete default via 192.168.1.150 dev wlan0 proto static</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新包管理器</span></span><br><span class="line">sudo apt update</span><br><span class="line"><span class="comment"># 安装常用软件</span></span><br><span class="line">sudo apt install -y zsh git vim tmux ufw neofetch aria2 lm-sensors glances exa</span><br><span class="line"><span class="comment"># 配置防火墙，# 设置legacy若ufw status报错</span></span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> iptables /usr/sbin/iptables-legacy</span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> ip6tables /usr/sbin/ip6tables-legacy</span><br><span class="line">sudo ufw status</span><br><span class="line">sudo ufw allow 22/tcp   comment ssh</span><br><span class="line">sudo ufw allow 5900/tcp comment vnc</span><br><span class="line">sudo ufw allow 2017/tcp comment v2raya</span><br><span class="line">sudo ufw allow 6800/tcp comment aria2</span><br><span class="line">sudo ufw <span class="built_in">enable</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装oh-my-zsh</span></span><br><span class="line">chsh -s $(<span class="built_in">which</span> zsh)</span><br><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>&quot;</span></span><br><span class="line"><span class="comment"># 如果安装路径有问题可以指定路径</span></span><br><span class="line">ZSH=<span class="string">&quot;<span class="variable">$HOME</span>/.oh-my-zsh&quot;</span> sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装oh-my-tmux</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/gpakosz/.tmux.git</span><br><span class="line">ln -s -f .tmux/.tmux.conf</span><br><span class="line">cp .tmux/.tmux.conf.local .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成ssh秘钥</span></span><br><span class="line">ssh-keygen</span><br><span class="line"><span class="comment"># 安装locales</span></span><br><span class="line">sudo apt install locales</span><br><span class="line"><span class="comment"># 配置语言</span></span><br><span class="line">sudo dpkg-reconfigure locales</span><br><span class="line"><span class="comment"># 调整时区</span></span><br><span class="line">sudo timedatectl set-timezone Asia/Shanghai</span><br></pre></td></tr></table></figure>

<p>没想到的是，切换oh-my-zsh的theme（可能是切换光标引起的，我切到jonathan就直接chromium segmentation fault），会导致chrome崩溃实属想不到，详见<a target="_blank" rel="noopener" href="https://bbs.archlinux.org/viewtopic.php?id=245833">这篇文章</a>……</p>
<p>装了<code>neofetch</code>看一下Debian的系统信息，起码硬件很强：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">       _,met$$$$$gg.          rock@rock-5b</span><br><span class="line">    ,g$$$$$$$$$$$$$$$P.       ------------</span><br><span class="line">  ,g$$P&quot;     &quot;&quot;&quot;Y$$.&quot;.        OS: Debian GNU/Linux 11 (bullseye) aarch64</span><br><span class="line"> ,$$P&#x27;              `$$$.     Host: Radxa ROCK 5B</span><br><span class="line">&#x27;,$$P       ,ggs.     `$$b:   Kernel: 5.10.66-27-rockchip-gea60d388902d</span><br><span class="line">`d$$&#x27;     ,$P&quot;&#x27;   .    $$$    Uptime: 27 mins</span><br><span class="line"> $$P      d$&#x27;     ,    $$P    Packages: 1141 (dpkg)</span><br><span class="line"> $$:      $$.   -    ,d$$&#x27;    Shell: zsh 5.8</span><br><span class="line"> $$;      Y$b._   _,d$P&#x27;      Terminal: /dev/pts/0</span><br><span class="line"> Y$$.    `.`&quot;Y$$$$P&quot;&#x27;         CPU: (8) @ 1.800GHz</span><br><span class="line"> `$$b      &quot;-.__              Memory: 365MiB / 15722MiB</span><br><span class="line">  `Y$$</span><br><span class="line">   `Y$$.</span><br><span class="line">     `$$b.</span><br><span class="line">       `Y$$b.</span><br><span class="line">          `&quot;Y$b._</span><br><span class="line">              `&quot;&quot;&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>或是Armbian的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">                              pi@rock-5b</span><br><span class="line">                              ----------</span><br><span class="line">   █ █ █ █ █ █ █ █ █ █ █      OS: Armbian (22.11.2) aarch64</span><br><span class="line">  ███████████████████████     Host: Radxa ROCK 5B</span><br><span class="line">▄▄██                   ██▄▄   Kernel: 5.10.110-rockchip-rk3588</span><br><span class="line">▄▄██    ███████████    ██▄▄   Uptime: 30 mins</span><br><span class="line">▄▄██   ██         ██   ██▄▄   Packages: 1551 (dpkg)</span><br><span class="line">▄▄██   ██         ██   ██▄▄   Shell: zsh 5.8.1</span><br><span class="line">▄▄██   ██         ██   ██▄▄   Resolution: 3840x2160</span><br><span class="line">▄▄██   █████████████   ██▄▄   Terminal: /dev/pts/1</span><br><span class="line">▄▄██   ██         ██   ██▄▄   CPU: (8) @ 1.800GHz</span><br><span class="line">▄▄██   ██         ██   ██▄▄   Memory: 830MiB / 15720MiB</span><br><span class="line">▄▄██   ██         ██   ██▄▄</span><br><span class="line">▄▄██                   ██▄▄</span><br><span class="line">  ███████████████████████</span><br><span class="line">   █ █ █ █ █ █ █ █ █ █ █</span><br></pre></td></tr></table></figure>

<h2 id="安装科学冲浪"><a href="#安装科学冲浪" class="headerlink" title="安装科学冲浪"></a>安装科学冲浪</h2><p>安装核心：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装或更新核心</span></span><br><span class="line">sudo bash -c <span class="string">&quot;<span class="subst">$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)</span>&quot;</span> @ install</span><br><span class="line"><span class="comment"># 仅更新核心</span></span><br><span class="line">sudo bash -c <span class="string">&quot;<span class="subst">$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)</span>&quot;</span> @ install-geodata</span><br><span class="line"><span class="comment"># 卸载核心</span></span><br><span class="line">sudo bash -c <span class="string">&quot;<span class="subst">$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)</span>&quot;</span> @ remove</span><br><span class="line"></span><br><span class="line">sudo systemctl status xray.service</span><br></pre></td></tr></table></figure>

<p>安装UI，直接在<a target="_blank" rel="noopener" href="https://github.com/v2rayA/v2rayA/releases">release</a>中挑了一个<a target="_blank" rel="noopener" href="https://github.com/v2rayA/v2rayA/releases/download/v1.5.9.1698.1/installer_debian_arm64_1.5.9.1698.1.deb">arm64的包</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/v2rayA/v2rayA/releases/download/v1.5.9.1698.1/installer_debian_arm64_1.5.9.1698.1.deb</span><br><span class="line">sudo apt install ./installer_debian_arm64_1.5.9.1698.1.deb</span><br><span class="line"><span class="comment"># 可以添加为系统服务</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> v2raya.service</span><br><span class="line">sudo systemctl start v2raya.service</span><br><span class="line">sudo systemctl status v2raya.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新防火墙</span></span><br><span class="line">sudo ufw allow 2017/tcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 若防火墙报错可以切换nft或legacy试试</span></span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> iptables /usr/sbin/iptables-nft</span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> ip6tables /usr/sbin/ip6tables-nft</span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> arptables /usr/sbin/arptables-nft</span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> ebtables /usr/sbin/ebtables-nft</span><br><span class="line"></span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> iptables /usr/sbin/iptables-legacy</span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> ip6tables /usr/sbin/ip6tables-legacy</span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> arptables /usr/sbin/arptables-legacy</span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> ebtables /usr/sbin/ebtables-legacy</span><br></pre></td></tr></table></figure>

<p>这是个WebUI，访问192.168.1.120:2017，官方推荐配置如下：</p>
<table>
<thead>
<tr>
<th align="left">配置</th>
<th align="left">选项</th>
</tr>
</thead>
<tbody><tr>
<td align="left">透明代理/系统代理</td>
<td align="left">启用: 大陆白名单模式</td>
</tr>
<tr>
<td align="left">透明代理/系统代理实现方式</td>
<td align="left">redirect</td>
</tr>
<tr>
<td align="left">规则端口的分流模式</td>
<td align="left">大陆白名单模式</td>
</tr>
<tr>
<td align="left">防止DNS污染</td>
<td align="left">仅防止DNS劫持(快速)</td>
</tr>
<tr>
<td align="left">特殊模式</td>
<td align="left">supervisor</td>
</tr>
<tr>
<td align="left">TCPFastOpen</td>
<td align="left">保持系统默认</td>
</tr>
<tr>
<td align="left">多路复用</td>
<td align="left">关闭</td>
</tr>
<tr>
<td align="left">自动更新订阅</td>
<td align="left">关闭</td>
</tr>
<tr>
<td align="left">解析订阅链接/更新时优先使用</td>
<td align="left">跟随透明代理/系统代理</td>
</tr>
</tbody></table>
<h2 id="配置aria2c服务"><a href="#配置aria2c服务" class="headerlink" title="配置aria2c服务"></a>配置aria2c服务</h2><p>http下载vscode之类大文件之前，最好把aria2配好，然后使用如<a target="_blank" rel="noopener" href="https://github.com/mayswind/AriaNg">AriaNg</a>All-In-One版的WebUI控制。</p>
<p>如果想要将aria2c配置为系统服务随机启动，就不能再想以前部署服务器一样在<code>$HOME</code>目录下新建<code>.conf</code>和<code>.session</code>文件来保存配置和会话信息了，因为<a target="_blank" rel="noopener" href="https://serverfault.com/questions/957084/failed-at-step-exec-spawning-permission-denied">Linux禁止系统服务从用户目录运行或访问用户目录</a>。因此，不论二进制文件还是配置文件，或是启动时需要访问的会话文件都得放在别的地方。比如可以将配置文件放在<code>/etc/aria2c.conf</code>中，将其他文件放在<code>/var/aria2c</code>目录下。</p>
<p>这里我使用的用户/组为<code>pi/pi</code>，若使用<code>www-data/www-data</code>下下来的文件用起来可能不方便。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/mayswind/AriaNg/releases/download/1.3.2/AriaNg-1.3.2-AllInOne.zip</span><br><span class="line">unzip ./AriaNg-1.3.2-AllInOne.zip</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新防火墙</span></span><br><span class="line">sudo ufw allow 6800/tcp</span><br><span class="line"><span class="comment"># 创建下载目录</span></span><br><span class="line">sudo mkdir -p /var/aria2c/Downloads</span><br><span class="line"><span class="comment"># 即使用于/var/tmp一样的访问权限</span></span><br><span class="line">sudo chmod 777 /var/aria2c /var/aria2c/Downloads</span><br><span class="line"><span class="comment"># 修改配置文件</span></span><br><span class="line">sudo vim /etc/aria2.conf</span><br></pre></td></tr></table></figure>

<p>配置如下，注意修改<code>&lt;your-rpc-secret&gt;</code>的远程密码：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## &#x27;#&#x27;开头为注释内容, 选项都有相应的注释说明, 根据需要修改 ##</span></span><br><span class="line"><span class="comment">## 被注释的选项填写的是默认值, 建议在需要修改时再取消注释  ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 文件保存相关 ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件的保存路径(可使用绝对路径或相对路径), 默认: 当前启动位置</span></span><br><span class="line"><span class="attr">dir</span>=/var/aria2c/Downloads</span><br><span class="line"><span class="comment"># 启用磁盘缓存, 0为禁用缓存, 需1.16以上版本, 默认:16M</span></span><br><span class="line"><span class="comment">#disk-cache=32M</span></span><br><span class="line"><span class="comment"># 文件预分配方式, 能有效降低磁盘碎片, 默认:prealloc</span></span><br><span class="line"><span class="comment"># 预分配所需时间: none &lt; falloc ? trunc &lt; prealloc</span></span><br><span class="line"><span class="comment"># falloc和trunc则需要文件系统和内核支持</span></span><br><span class="line"><span class="comment"># NTFS建议使用falloc, EXT3/4建议trunc, MAC 下需要注释此项</span></span><br><span class="line"><span class="comment">#file-allocation=none</span></span><br><span class="line"><span class="comment"># 断点续传</span></span><br><span class="line"><span class="attr">continue</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 下载连接相关 ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最大同时下载任务数, 运行时可修改, 默认:5</span></span><br><span class="line"><span class="comment">#max-concurrent-downloads=5</span></span><br><span class="line"><span class="comment"># 同一服务器连接数, 添加时可指定, 默认:1</span></span><br><span class="line"><span class="attr">max-connection-per-server</span>=<span class="number">16</span></span><br><span class="line"><span class="comment"># 最小文件分片大小, 添加时可指定, 取值范围1M -1024M, 默认:20M</span></span><br><span class="line"><span class="comment"># 假定size=10M, 文件为20MiB 则使用两个来源下载; 文件为15MiB 则使用一个来源下载</span></span><br><span class="line"><span class="attr">min-split-size</span>=<span class="number">4</span>M</span><br><span class="line"><span class="comment"># 单个任务最大线程数, 添加时可指定, 默认:5</span></span><br><span class="line"><span class="attr">split</span>=<span class="number">16</span></span><br><span class="line"><span class="comment"># 整体下载速度限制, 运行时可修改, 默认:0</span></span><br><span class="line"><span class="attr">max-overall-download-limit</span>=<span class="number">3000000</span></span><br><span class="line"><span class="comment"># 单个任务下载速度限制, 默认:0</span></span><br><span class="line"><span class="comment">#max-download-limit=0</span></span><br><span class="line"><span class="comment"># 整体上传速度限制, 运行时可修改, 默认:0</span></span><br><span class="line"><span class="attr">max-overall-upload-limit</span>=<span class="number">50000</span></span><br><span class="line"><span class="comment"># 单个任务上传速度限制, 默认:0</span></span><br><span class="line"><span class="comment">#max-upload-limit=0</span></span><br><span class="line"><span class="comment"># 禁用IPv6, 默认:false</span></span><br><span class="line"><span class="attr">disable-ipv6</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 连接超时时间, 默认:60</span></span><br><span class="line"><span class="comment">#timeout=60</span></span><br><span class="line"><span class="comment"># 最大重试次数, 设置为0表示不限制重试次数, 默认:5</span></span><br><span class="line"><span class="comment">#max-tries=5</span></span><br><span class="line"><span class="comment"># 设置重试等待的秒数, 默认:0</span></span><br><span class="line"><span class="comment">#retry-wait=0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 进度保存相关 ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从会话文件中读取下载任务</span></span><br><span class="line"><span class="attr">input-file</span>=/var/aria2c/aria2c.session</span><br><span class="line"><span class="comment"># 在Aria2退出时保存`错误/未完成`的下载任务到会话文件</span></span><br><span class="line"><span class="attr">save-session</span>=/var/aria2c/aria2c.session</span><br><span class="line"><span class="comment"># 定时保存会话, 0为退出时才保存, 需1.16.1以上版本, 默认:0</span></span><br><span class="line"><span class="attr">save-session-interval</span>=<span class="number">60</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## RPC相关设置 ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用RPC, 默认:false</span></span><br><span class="line"><span class="attr">enable-rpc</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 允许所有来源, 默认:false</span></span><br><span class="line"><span class="attr">rpc-allow-origin-all</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 允许非外部访问, 默认:false</span></span><br><span class="line"><span class="attr">rpc-listen-all</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 事件轮询方式, 取值:[epoll, kqueue, port, poll, select], 不同系统默认值不同</span></span><br><span class="line"><span class="comment">#event-poll=select</span></span><br><span class="line"><span class="comment"># RPC监听端口, 端口被占用时可以修改, 默认:6800</span></span><br><span class="line"><span class="attr">rpc-listen-port</span>=<span class="number">6800</span></span><br><span class="line"><span class="comment"># 设置的RPC授权令牌, v1.18.4新增功能, 取代 --rpc-user 和 --rpc-passwd 选项</span></span><br><span class="line"><span class="attr">rpc-secret</span>=&lt;your-rpc-secret&gt;</span><br><span class="line"><span class="comment"># 设置的RPC访问用户名, 此选项新版已废弃, 建议改用 --rpc-secret 选项</span></span><br><span class="line"><span class="comment">#rpc-user=&lt;USER&gt;</span></span><br><span class="line"><span class="comment"># 设置的RPC访问密码, 此选项新版已废弃, 建议改用 --rpc-secret 选项</span></span><br><span class="line"><span class="comment">#rpc-passwd=&lt;PASSWD&gt;</span></span><br><span class="line"><span class="comment"># 是否启用 RPC 服务的 SSL/TLS 加密,</span></span><br><span class="line"><span class="comment"># 启用加密后 RPC 服务需要使用 https 或者 wss 协议连接</span></span><br><span class="line"><span class="comment">#rpc-secure=true</span></span><br><span class="line"><span class="comment"># 在 RPC 服务中启用 SSL/TLS 加密时的证书文件,</span></span><br><span class="line"><span class="comment"># 使用 PEM 格式时，您必须通过 --rpc-private-key 指定私钥</span></span><br><span class="line"><span class="comment">#rpc-certificate=/path/to/certificate.pem</span></span><br><span class="line"><span class="comment"># 在 RPC 服务中启用 SSL/TLS 加密时的私钥文件</span></span><br><span class="line"><span class="comment">#rpc-private-key=/path/to/certificate.key</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## BT/PT下载相关 ##</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当下载的是一个种子(以.torrent结尾)时, 自动开始BT任务, 默认:true</span></span><br><span class="line"><span class="attr">follow-torrent</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment"># BT监听端口, 当端口被屏蔽时使用, 默认:6881-6999</span></span><br><span class="line"><span class="attr">listen-port</span>=<span class="number">51414</span></span><br><span class="line"><span class="comment"># 单个种子最大连接数, 默认:55</span></span><br><span class="line"><span class="comment">#bt-max-peers=55</span></span><br><span class="line"><span class="comment"># 打开DHT功能, PT需要禁用, 默认:true</span></span><br><span class="line"><span class="attr">enable-dht</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 打开IPv6 DHT功能, PT需要禁用</span></span><br><span class="line"><span class="comment">#enable-dht6=false</span></span><br><span class="line"><span class="comment"># DHT网络监听端口, 默认:6881-6999</span></span><br><span class="line"><span class="attr">dht-listen-port</span>=<span class="number">6881</span>-<span class="number">6999</span></span><br><span class="line"><span class="comment"># 本地节点查找, PT需要禁用, 默认:false</span></span><br><span class="line"><span class="attr">bt-enable-lpd</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 种子交换, PT需要禁用, 默认:true</span></span><br><span class="line"><span class="attr">enable-peer-exchange</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 每个种子限速, 对少种的PT很有用, 默认:50K</span></span><br><span class="line"><span class="attr">bt-request-peer-speed-limit</span>=<span class="number">3</span>M</span><br><span class="line"><span class="comment"># 客户端伪装, PT需要</span></span><br><span class="line"><span class="attr">peer-id-prefix</span>=-TR2770-</span><br><span class="line"><span class="attr">user-agent</span>=Transmission/<span class="number">2.77</span></span><br><span class="line"><span class="attr">peer-agent</span>=Transmission/<span class="number">2.77</span></span><br><span class="line"><span class="comment"># 当种子的分享率达到这个数时, 自动停止做种, 0为一直做种, 默认:1.0</span></span><br><span class="line"><span class="attr">seed-ratio</span>=<span class="number">1.0</span></span><br><span class="line"><span class="attr">seed-time</span>=<span class="number">0</span></span><br><span class="line"><span class="comment"># 强制保存会话, 即使任务已经完成, 默认:false</span></span><br><span class="line"><span class="comment"># 较新的版本开启后会在任务完成后依然保留.aria2文件</span></span><br><span class="line"><span class="comment">#force-save=false</span></span><br><span class="line"><span class="comment"># BT校验相关, 默认:true</span></span><br><span class="line"><span class="comment">#bt-hash-check-seed=true</span></span><br><span class="line"><span class="comment"># 继续之前的BT任务时, 无需再次校验, 默认:false</span></span><br><span class="line"><span class="attr">bt-seed-unverified</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 保存磁力链接元数据为种子文件(.torrent文件), 默认:false</span></span><br><span class="line"><span class="attr">bt-save-metadata</span>=<span class="literal">false</span></span><br><span class="line"><span class="comment"># dht-file</span></span><br><span class="line"><span class="attr">dht-file-path</span>=/var/aria2c/dht.dat</span><br><span class="line"><span class="comment"># 删除未选择的文件</span></span><br><span class="line"><span class="attr">bt-remove-unselected-file</span>=<span class="literal">true</span></span><br><span class="line"><span class="comment"># 无速度时自动停止时间</span></span><br><span class="line"><span class="comment">#bt-stop-timeout=1800</span></span><br></pre></td></tr></table></figure>

<p>添加启动项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/aria2c.service</span><br></pre></td></tr></table></figure>

<p>修改配置文件：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Aria2c download manager</span><br><span class="line"><span class="attr">Requires</span>=network.target</span><br><span class="line"><span class="attr">After</span>=dhcpcd.service</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=forking</span><br><span class="line"><span class="attr">User</span>=pi</span><br><span class="line"><span class="attr">Group</span>=pi</span><br><span class="line"><span class="attr">ExecStartPre</span>=/usr/bin/env touch /var/aria2c/aria2c.session</span><br><span class="line"><span class="attr">WorkingDirectory</span>=/var/aria2c/</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/bin/aria2c --conf-path=/etc/aria2.conf -D</span><br><span class="line"><span class="attr">TimeoutStopSec</span>=<span class="number">20</span></span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure>

<p>测试启动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> aria2c.service</span><br><span class="line">sudo systemctl start aria2c.service</span><br><span class="line">sudo systemctl status aria2c.service</span><br></pre></td></tr></table></figure>

<h2 id="安装vscode"><a href="#安装vscode" class="headerlink" title="安装vscode"></a>安装vscode</h2><p>添加微软源安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install wget gpg</span><br><span class="line">wget -qO- https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor &gt; packages.microsoft.gpg</span><br><span class="line">sudo install -D -o root -g root -m 644 packages.microsoft.gpg /etc/apt/keyrings/packages.microsoft.gpg</span><br><span class="line">sudo sh -c <span class="string">&#x27;echo &quot;deb [arch=amd64,arm64,armhf signed-by=/etc/apt/keyrings/packages.microsoft.gpg] https://packages.microsoft.com/repos/code stable main&quot; &gt; /etc/apt/sources.list.d/vscode.list&#x27;</span></span><br><span class="line">rm -f packages.microsoft.gpg</span><br><span class="line"></span><br><span class="line">sudo apt install apt-transport-https</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install code <span class="comment"># or code-insiders</span></span><br></pre></td></tr></table></figure>

<p>或是下载deb安装：</p>
<p>下载<a target="_blank" rel="noopener" href="https://code.visualstudio.com/download">微软官方</a>的<a target="_blank" rel="noopener" href="https://az764295.vo.msecnd.net/stable/6261075646f055b99068d3688932416f2346dd3b/code_1.73.1-1667966450_arm64.deb">arm64 deb</a>安装即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://az764295.vo.msecnd.net/stable/6261075646f055b99068d3688932416f2346dd3b/code_1.73.1-1667966450_arm64.deb</span><br><span class="line">sudo apt install ./code_1.73.1-1667966450_arm64.deb</span><br></pre></td></tr></table></figure>

<h2 id="安装wps-office"><a href="#安装wps-office" class="headerlink" title="安装wps-office"></a>安装wps-office</h2><p>在<a target="_blank" rel="noopener" href="https://linux.wps.cn/">wps主页</a>下载即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://wps-linux-personal.wpscdn.cn/wps/download/ep/Linux2019/11664/wps-office_11.1.0.11664_arm64.deb</span><br><span class="line">sudo apt install ./wps-office_11.1.0.11664_arm64.deb</span><br></pre></td></tr></table></figure>

<h2 id="Armbian安装rime输入法"><a href="#Armbian安装rime输入法" class="headerlink" title="Armbian安装rime输入法"></a>Armbian安装rime输入法</h2><p><a target="_blank" rel="noopener" href="https://neucrack.com/p/466">这篇文章</a>中fcitx5+rime的方法我没安装成功，就转向这个<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/19839748">答案</a>，使用ibus+rime的组合。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ibus ibus-rime</span><br></pre></td></tr></table></figure>

<p>在<code>区域与语言</code>-&gt;<code>管理已安装的语言</code>-&gt;<code>键盘输入法系统</code>-&gt;选择<code>IBus</code>。此时在<code>keyboard</code>-&gt;<code>input source</code>中能看到<code>汉语</code>-&gt;<code>中文（Rime）</code>（没有重启即可），选上即可。重启后，右上角出现ibus的选择框，选<code>中文（Rime）</code>后报错，查看日志：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat /tmp/rime.fcitx-rime.ERROR</span><br><span class="line">E0116 16:40:14.597605  4678 deployment_tasks.cc:212] missing input schema: luna_pinyin</span><br><span class="line">E0116 16:40:14.598170  4678 deployment_tasks.cc:212] missing input schema: luna_pinyin_simp</span><br><span class="line">E0116 16:40:14.598309  4678 deployment_tasks.cc:212] missing input schema: luna_pinyin_fluency</span><br><span class="line">E0116 16:40:14.598423  4678 deployment_tasks.cc:212] missing input schema: bopomofo</span><br><span class="line">E0116 16:40:14.598546  4678 deployment_tasks.cc:212] missing input schema: bopomofo_tw</span><br><span class="line">E0116 16:40:14.598660  4678 deployment_tasks.cc:212] missing input schema: cangjie5</span><br><span class="line">E0116 16:40:14.598773  4678 deployment_tasks.cc:212] missing input schema: stroke</span><br><span class="line">E0116 16:40:14.598884  4678 deployment_tasks.cc:212] missing input schema: terra_pinyin</span><br></pre></td></tr></table></figure>

<p>用<code>apt</code>搜索<code>rime</code>发现需要继续安装data包（不必装全，最关键的应该是luna-pinyin）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install rime-data-luna-pinyin rime-data-pinyin-simp rime-data-bopomofo rime-data-cangjie5 rime-data-stroke rime-data-terra-pinyin</span><br></pre></td></tr></table></figure>

<p>随便找个能输入的地方，此时左上角已经可以切换到Rime输入法了，随意输入后按<code>F4</code>调出菜单界面选择<code>朙月拼音 简化字</code>即可。</p>
<h2 id="Armbian安装谷歌输入法"><a href="#Armbian安装谷歌输入法" class="headerlink" title="Armbian安装谷歌输入法"></a>Armbian安装谷歌输入法</h2><p>上安装中文输入法，我选了fcitx，不过中间需要很多玄学操作（UI上的操作就是“支持的语言”、“语言/区域”这种地方把中文选上，把默认输入法选成<code>fcitx</code>），关键是用<code>fcitx-configtool</code>查看报错，哪里飘红搜哪里。通常需要的操作是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我也不知道到底是哪些包起作用</span></span><br><span class="line">sudo apt install fcitx fcitx-pinyin fcitx-googlepinyin fcitx-config-gtk fcitx-frontend-all fcitx-frontend-gtk2 fcitx-frontend-gtk3 fcitx-frontend-qt5 fcitx-libs-dev  fcitx-ui-classic fcitx-ui-qimpanel fcitx-ui-light fcitx-table </span><br><span class="line"><span class="comment"># 在shell配置文件里加几个环境变量</span></span><br><span class="line"><span class="built_in">export</span> GTK_IM_MODULE=fcitx</span><br><span class="line"><span class="built_in">export</span> QT_IM_MODULE=fcitx</span><br><span class="line">XMODIFIERS=@im=fcitx</span><br><span class="line"><span class="comment"># 设置开机启动</span></span><br><span class="line">cp /usr/share/applications/fcitx.desktop ~/.config/autostart/fcitx.desktop</span><br><span class="line"><span class="comment"># 用fcitx配置工具查看谷歌拼音之类的中文输入法有没有显式出来</span></span><br><span class="line">fcitx-configtool</span><br><span class="line"><span class="comment"># 用输入法配置工具查看需要装什么东西</span></span><br><span class="line">im-config</span><br><span class="line"><span class="comment"># 根据诊断工具debug</span></span><br><span class="line">fcitx-diagnose</span><br><span class="line"><span class="comment"># 解决诊断工具中`gtk-query-immodules-3.0`和`gtk-query-immodules-2.0`的报错</span></span><br><span class="line">sudo ln -s /usr/lib/aarch64-linux-gnu/libgtk-3-0/gtk-query-immodules-3.0 /usr/bin/gtk-query-immodules-3.0</span><br><span class="line">sudo ln -s /usr/lib/aarch64-linux-gnu/libgtk2.0-0/gtk-query-immodules-2.0 /usr/bin/gtk-query-immodules-2.0</span><br></pre></td></tr></table></figure>

<h2 id="安装chromium（有些民间Armbian镜像没有浏览器）"><a href="#安装chromium（有些民间Armbian镜像没有浏览器）" class="headerlink" title="安装chromium（有些民间Armbian镜像没有浏览器）"></a>安装chromium（有些民间Armbian镜像没有浏览器）</h2><p><strong>注：chromium升级后不需要再进行下面的操作了，直接<code>apt install chromium-browser</code>即可。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install chromium-browser</span><br></pre></td></tr></table></figure>

<p>如果chromium慢，可能是登录的时候没用wayland（我习惯用ubuntu-wayland，速度上gnome-wayland也一样）。</p>
<p>可以<a target="_blank" rel="noopener" href="https://launchpad.net/~liujianfeng1994/+archive/ubuntu/rockchip-multimedia/">换源</a>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">sudo apt remove --purge chromium-browser chromium-codecs-ffmpeg-extra</span><br><span class="line">sudo apt install chromium-browser=$(apt-cache show chromium-browser|grep Version|grep rkmpp|cut -d <span class="string">&quot; &quot;</span> -f2) chromium-codecs-ffmpeg-extra=$(apt-cache show chromium-browser|grep Version|grep rkmpp|cut -d <span class="string">&quot; &quot;</span> -f2) libv4l-rkmpp v4l-utils</span><br><span class="line"></span><br><span class="line">sudo ln -s /lib /usr/lib64</span><br><span class="line"><span class="built_in">cd</span> /usr/lib64/ &amp;&amp; sudo ln -s aarch64-linux-gnu/libv4l2.so.0.0.0 libv4l2.so</span><br><span class="line"></span><br><span class="line">sudo vim /etc/rc.local:</span><br><span class="line"><span class="comment"># 添加以下内容</span></span><br><span class="line"><span class="built_in">echo</span> dec &gt; /dev/video-dec0</span><br><span class="line">chown root:video /dev/video-dec0</span><br><span class="line">chmod 0660 /dev/video-dec0</span><br><span class="line"><span class="built_in">echo</span> enc &gt; /dev/video-enc0</span><br><span class="line">chown root:video /dev/video-enc0</span><br><span class="line">chmod 0660 /dev/video-enc0</span><br><span class="line"></span><br><span class="line">sudo vim /etc/chromium-browser/default</span><br><span class="line"><span class="comment"># 替换默认flag</span></span><br><span class="line">CHROMIUM_FLAGS=<span class="string">&quot;--use-gl=egl&quot;</span></span><br><span class="line"></span><br><span class="line">sudo apt install gstreamer1.0-rockchip1 gstreamer1.0-alsa gstreamer1.0-pipewire gstreamer1.0-plugins-base-apps gstreamer1.0-plugins-base gstreamer1.0-x libgstreamer-gl1.0-0 libgstreamer-plugins-base1.0-0 clapper ffmpeg kodi moonlight-embedded obs-gstreamer obs-studio</span><br></pre></td></tr></table></figure>

<h2 id="安装syncthing"><a href="#安装syncthing" class="headerlink" title="安装syncthing"></a>安装syncthing</h2><p>尝试部署一个syncthing服务器，在4x的服务器上安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -sS https://webinstall.dev/syncthing | bash</span><br><span class="line"><span class="built_in">source</span> ~/.config/envman/PATH.env</span><br></pre></td></tr></table></figure>

<p>在公网IP上开GUI配置界面，并开启防火墙：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">syncthing --gui-address=0.0.0.0:8384</span><br><span class="line">sudo firewall-cmd --zone=public --permanent --add-port=8384/tcp  <span class="comment"># WEB-UII界面</span></span><br><span class="line">sudo firewall-cmd --zone=public --permanent --add-port=22000/tcp <span class="comment"># 通信端口</span></span><br></pre></td></tr></table></figure>

<p>在想用的机子上：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install syncthing</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> syncthing-resume.service</span><br><span class="line">systemctl --user <span class="built_in">enable</span> syncthing.service</span><br><span class="line">systemctl --user start syncthing.service</span><br><span class="line">systemctl --user status syncthing.service</span><br></pre></td></tr></table></figure>

<h2 id="民间旧版Armbian遗留操作"><a href="#民间旧版Armbian遗留操作" class="headerlink" title="民间旧版Armbian遗留操作"></a>民间旧版Armbian遗留操作</h2><p>他们官网上说对debian做了优化，比如尽量使用内存，减少落盘读写什么的。Radax的群里有大佬做了action<a target="_blank" rel="noopener" href="https://github.com/Headcrabed/armbian-rock5b-images/releases/">日更镜像</a>，可以试一下。另外，Armbian官方也更新了适用于Rock5B的<a target="_blank" rel="noopener" href="https://www.armbian.com/rock-5b/">镜像</a>。</p>
<p>如果刷了armbian接HDMI时<code>ctrl</code>+<code>alt</code>+<code>F7</code>只有光标，回<code>ctrl</code>+<code>alt</code>+<code>F1</code>看<code>dmesg</code>八成是显卡驱动问题：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令行下搜WiFi</span></span><br><span class="line">iwlist scanning</span><br><span class="line"><span class="comment"># 加入WiFi</span></span><br><span class="line">nmcli d wifi connect <span class="string">&quot;&lt;your-ssid&gt;&quot;</span> password &lt;your-password&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载显卡驱动固件</span></span><br><span class="line">wget https://github.com/JeffyCN/rockchip_mirrors/raw/libmali/firmware/g610/mali_csffw.bin</span><br><span class="line">sudo mv mali_csffw.bin /lib/firmware/</span><br><span class="line"><span class="comment"># 添加大佬源</span></span><br><span class="line">sudo add-apt-repository ppa:liujianfeng1994/panfork-mesa</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade</span><br></pre></td></tr></table></figure>

<h2 id="Armbian安装docker"><a href="#Armbian安装docker" class="headerlink" title="Armbian安装docker"></a>Armbian安装docker</h2><p>按照<a target="_blank" rel="noopener" href="https://i12bretro.github.io/tutorials/0476.html">这篇文章</a>一次安装完成：</p>
<ol>
<li><p>更新，安装依赖：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># update software repositories</span></span><br><span class="line">sudo apt update</span><br><span class="line"><span class="comment"># install necessary packages for https apt calls</span></span><br><span class="line">sudo apt install apt-transport-https ca-certificates curl gnupg-agent software-properties-common</span><br></pre></td></tr></table></figure></li>
<li><p>使用Ubuntu构建的Armbian添加如下gpg秘钥：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add docker GPG key</span></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line"><span class="comment"># add docker software repository</span></span><br><span class="line">sudo add-apt-repository <span class="string">&quot;deb [arch=arm64] https://download.docker.com/linux/ubuntu <span class="subst">$(lsb_release -cs)</span> stable&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>使用Debian构建的Armbian添加如下gpg秘钥：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add docker GPG key</span></span><br><span class="line">curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -</span><br><span class="line"><span class="comment"># add docker software repository</span></span><br><span class="line">sudo add-apt-repository <span class="string">&quot;deb [arch=arm64] https://download.docker.com/linux/debian <span class="subst">$(lsb_release -cs)</span> stable&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>安装docker：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install docker</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="comment"># start docker service</span></span><br><span class="line">sudo systemctl start docker</span><br><span class="line"><span class="comment"># enable docker service on startup</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br><span class="line"><span class="comment"># create a docker group</span></span><br><span class="line">sudo groupadd docker</span><br><span class="line"><span class="comment"># add the current user to the docker group</span></span><br><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure></li>
<li><p>使用hello-world镜像测试安装结果：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br><span class="line"></span><br><span class="line">Unable to find image <span class="string">&#x27;hello-world:latest&#x27;</span> locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">7050e35b49f5: Pull complete</span><br><span class="line">Digest: sha256:faa03e786c97f07ef34423fccceeec2398ec8a5759259f94d99078f264e9d7af</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line">1. The Docker client contacted the Docker daemon.</span><br><span class="line">2. The Docker daemon pulled the <span class="string">&quot;hello-world&quot;</span> image from the Docker Hub.</span><br><span class="line">    (arm64v8)</span><br><span class="line">3. The Docker daemon created a new container from that image <span class="built_in">which</span> runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line">4. The Docker daemon streamed that output to the Docker client, <span class="built_in">which</span> sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line">$ docker run -it ubuntu bash</span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line">https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line">https://docs.docker.com/get-started/</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="挂载smb共享"><a href="#挂载smb共享" class="headerlink" title="挂载smb共享"></a>挂载smb共享</h2><p>直接安装rock5b上的vlc和vlc-plugin-samba后，vlc仍然无法打开smb共享中的文件，若使用mpv时会报错说”ffmpeg protocol not found. make sure ffmpeg/libav is compiled with networking support … smb”，可能是编译的时候没有带smb模块吧，懒得研究这个了，干脆将smb共享挂载为本地文件。</p>
<p>参考<a target="_blank" rel="noopener" href="https://wiki.ubuntu.com/MountWindowsSharesPermanently#Mount_password_protected_network_folders">Mount password protected network folders</a>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install cifs-utils</span><br><span class="line">sudo mkdir /media/exos_1t</span><br><span class="line">vim ~/.smbcredentials</span><br><span class="line"><span class="comment">#.smbcredentials</span></span><br><span class="line">username=username</span><br><span class="line">password=password</span><br><span class="line"></span><br><span class="line">chmod 600 ~/.smbcredentials</span><br><span class="line"></span><br><span class="line">//servername/EXOS_1T /media/exos_1t cifs credentials=/home/pi/.smbcredentials,iocharset=utf8 0 0 </span><br></pre></td></tr></table></figure>

<h2 id="尝试玩游戏"><a href="#尝试玩游戏" class="headerlink" title="尝试玩游戏"></a>尝试玩游戏</h2><p>B站上偶然间看到一个<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1cK41127Px/">大佬的视频</a>，大佬即是UP又是<a target="_blank" rel="noopener" href="https://github.com/ChisBread/malior">malior</a>的作者，运行这个库需要先装docker再部署：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">wget -O - https://github.com/ChisBread/malior/raw/main/install.sh &gt; /tmp/malior-install.sh &amp;&amp; bash /tmp/malior-install.sh  &amp;&amp; rm /tmp/malior-install.sh </span><br><span class="line">malior-sudo <span class="string">&#x27;echo $USER&#x27;</span> <span class="comment"># 拉rk3588-gaming的镜像时间比较长</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装wine，时间比较长</span></span><br><span class="line">malior install wine</span><br><span class="line"><span class="comment"># 安装中文环境:</span></span><br><span class="line">malior winetricks -q fakechinese wenquanyi</span><br><span class="line"><span class="comment"># 游戏貌似必须放在`~/.local/malior/`目录下，红警跑起来报Yuri.exe的错</span></span><br><span class="line">malior wine <span class="string">&quot;~/.local/malior/games/CandC_RA2/CandC_RA2YR/YURI.exe&quot;</span></span><br><span class="line"><span class="comment"># 冰封王座，但是声音只会出来一秒，在设置的声音里选一下输出设备就好了</span></span><br><span class="line"><span class="comment"># `-windows`是窗口模式，不加就是全屏：</span></span><br><span class="line">malior wine <span class="string">&quot;~/.local/malior/games/Warcraft3_1.24E/War3.exe -opengl -windows&quot;</span></span><br><span class="line"><span class="comment"># 混乱之治加上`-classic`</span></span><br><span class="line">malior wine <span class="string">&quot;~/.local/malior/games/Warcraft3_1.24E/War3.exe -opengl -classic&quot;</span></span><br></pre></td></tr></table></figure>

<p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.hiveworkshop.com/threads/complete-command-line-arguments-guide.288224/">魔兽命令行参数</a></li>
</ul>
<h2 id="安装node"><a href="#安装node" class="headerlink" title="安装node"></a>安装node</h2><p>node对arm64的支持貌似最高到14，更高的我没测试。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装nvm</span></span><br><span class="line">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.2/install.sh | bash</span><br><span class="line"><span class="comment"># 安装node 14</span></span><br><span class="line">nvm install 14</span><br></pre></td></tr></table></figure>

<h2 id="安装Anaconda"><a href="#安装Anaconda" class="headerlink" title="安装Anaconda"></a>安装Anaconda</h2><p>anaconda也支持arm64，虽然Python不随最新的，但是包多省心啊。去<a target="_blank" rel="noopener" href="https://repo.anaconda.com/archive/">anaconda</a>或者<a target="_blank" rel="noopener" href="https://repo.anaconda.com/miniconda/">miniconda</a>下载一个arm64的<code>.sh</code>安装就好了。</p>
<h2 id="备份tf卡"><a href="#备份tf卡" class="headerlink" title="备份tf卡"></a>备份tf卡</h2><p>装了这么多东西，有必要备份一下系统，我这里备在samba的一个盘上了，5.7G备了一个小时（macOS上<code>64k</code>的<code>k</code>要小写，否则报错）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dd <span class="keyword">if</span>=/dev/disk2 conv=sync,noerror bs=64k status=progress | gzip -c &gt; /Volumes/EXOS_1T/backup_image20221129.img.gz</span><br></pre></td></tr></table></figure>

<p>恢复：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gunzip -c /Volumes/EXOS_1T/backup_image20221129.img.gz | dd of=/dev/disk2 bs=64k status=progress</span><br></pre></td></tr></table></figure>

<h2 id="maskrom模式写入emmc"><a href="#maskrom模式写入emmc" class="headerlink" title="maskrom模式写入emmc"></a>maskrom模式写入emmc</h2><p>买个民间大神的<a target="_blank" rel="noopener" href="https://github.com/AghostPrj/Radxa-emmc-module">emmc模块</a>比官方便宜很多。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装rkdeveloptool</span></span><br><span class="line">sudo port install automake autoconf libusb <span class="comment"># 或 brew install automake autoconf libusb</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/radxa/rkdeveloptool.git</span><br><span class="line"><span class="built_in">cd</span> rkdeveloptool</span><br><span class="line">autoreconf -i</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo cp rkdeveloptool /opt/homebrew/bin/</span><br><span class="line"><span class="comment"># 测试rkdeveloptool</span></span><br><span class="line">rkdeveloptool -v</span><br><span class="line">rkdeveloptool ver 1.32</span><br></pre></td></tr></table></figure>
<p>烧录镜像，按住maskrom后type-c口接电脑，使用<code>lsusb</code>验证USB设备显示<code>Bus 020 Device 031: ID 2207:350b Fuzhou Rockchip Electronics Company</code>。运行<code>rkdeveloptool</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo rkdeveloptool ld</span><br><span class="line">DevNo=1	Vid=0x2207,Pid=0x350b,LocationID=1402	Maskrom</span><br><span class="line"><span class="comment"># 下载spl loader</span></span><br><span class="line">wget https://dl.radxa.com/rock5/sw/images/loader/rock-5b/rk3588_spl_loader_v1.08.111.bin</span><br><span class="line"><span class="comment"># 初始化ram并准备闪存环境</span></span><br><span class="line">sudo rkdeveloptool db ./rk3588_spl_loader_v1.08.111.bin</span><br><span class="line">Downloading bootloader succeeded.</span><br><span class="line"><span class="comment"># 写入镜像，如果是Armbian官网的.xz镜像则需要解压为.img</span></span><br><span class="line">sudo rkdeveloptool wl 0 Armbian_22.11.2_Rock-5b_jammy_legacy_5.10.110_gnome_desktop.img</span><br></pre></td></tr></table></figure>

<h2 id="GPIO的PWM"><a href="#GPIO的PWM" class="headerlink" title="GPIO的PWM"></a>GPIO的PWM</h2><p>参考<a target="_blank" rel="noopener" href="https://forum.radxa.com/t/python-gpio-peripheral-library-for-rock-5/12718">这篇文章</a>，用<a target="_blank" rel="noopener" href="https://github.com/happyme531/Adafruit_Blinka">大佬的Blinka</a>，先看<a target="_blank" rel="noopener" href="https://learn.adafruit.com/circuitpython-on-orangepi-linux/orange-pi-pc-setup">香橙派的手册</a>作参考：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y python3 python3-pip</span><br><span class="line">sudo apt install libgpiod2 python3-libgpiod</span><br><span class="line">pip3 install gpiod</span><br><span class="line">pip3 install --upgrade setuptools</span><br><span class="line">pip3 freeze - <span class="built_in">local</span> | grep -v <span class="string">&#x27;^\-e&#x27;</span> | cut -d = -f 1 | xargs -n1 pip3 install -U</span><br><span class="line"></span><br><span class="line">sudo apt install -y python3-smbus2 python3-dev i2c-tools</span><br><span class="line">sudo pip3 install Adafruit-Blinka</span><br></pre></td></tr></table></figure>

<p>安了一大堆东西，在5b的vscode上按<a target="_blank" rel="noopener" href="https://docs.circuitpython.org/en/latest/shared-bindings/pwmio/index.html#module-pwmio">手册</a>写代码测试一下，GPIO的pin定义在<a target="_blank" rel="noopener" href="https://github.com/adafruit/Adafruit_Blinka/blob/main/src/adafruit_blinka/board/radxa/rock5.py">rock5.py</a>中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> board</span><br><span class="line"><span class="keyword">import</span> pwmio</span><br><span class="line">pwm = pwmio.PWMOut(board.PWM14)</span><br></pre></td></tr></table></figure>

<p>在vscode的<code>launch.json</code>中要加上<code>&quot;sudo&quot;: true</code>和<code>&quot;justMyCode&quot;: false</code>两个选项，即“以管理员身份调试运行”和“调试库代码”，单步调试<code>adafruit_blinka/microcontroller/rockchip/PWMOut.py</code>中的<code>PWMOut</code>类时发现这段代码需要访问<code>/sys/class/pwm/pwmchip0/pwm14</code>这个文件，但是我只有<code>/sys/class/pwm/pwmchip0/pwm0</code>，而且感觉我的这个文件是风扇在用。</p>
<p>问了一下群里大神，可能跟设备树有关，有人说要改dts编译dtb后替换现有文件，有人说改overlay可能也行，搜了半天，找到<a target="_blank" rel="noopener" href="https://docs.armbian.com/User-Guide_Allwinner_overlays/">这篇文章</a>。改overlay即可：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看有哪些overlay</span></span><br><span class="line">exa -alT /boot/dtb/rockchip/overlay/</span><br><span class="line"><span class="comment">#...</span></span><br><span class="line">.rwxr-xr-x  309 root  8 12月  2022 ├── rk3588-pwm2-m1.dtbo</span><br><span class="line">.rwxr-xr-x  309 root  8 12月  2022 ├── rk3588-pwm3-m1.dtbo</span><br><span class="line">.rwxr-xr-x  309 root  8 12月  2022 ├── rk3588-pwm5-m2.dtbo</span><br><span class="line">.rwxr-xr-x  309 root  8 12月  2022 ├── rk3588-pwm6-m2.dtbo</span><br><span class="line">.rwxr-xr-x  309 root  8 12月  2022 ├── rk3588-pwm7-m3.dtbo</span><br><span class="line">.rwxr-xr-x  309 root  8 12月  2022 ├── rk3588-pwm8-m0.dtbo</span><br><span class="line">.rwxr-xr-x  311 root  8 12月  2022 ├── rk3588-pwm12-m0.dtbo</span><br><span class="line">.rwxr-xr-x  311 root  8 12月  2022 ├── rk3588-pwm13-m0.dtbo</span><br><span class="line">.rwxr-xr-x  311 root  8 12月  2022 ├── rk3588-pwm13-m2.dtbo</span><br><span class="line">.rwxr-xr-x  311 root  8 12月  2022 ├── rk3588-pwm14-m0.dtbo</span><br><span class="line">.rwxr-xr-x  311 root  8 12月  2022 ├── rk3588-pwm14-m1.dtbo</span><br><span class="line">.rwxr-xr-x  311 root  8 12月  2022 ├── rk3588-pwm15-m0.dtbo</span><br><span class="line">.rwxr-xr-x  311 root  8 12月  2022 ├── rk3588-pwm15-m1.dtbo</span><br><span class="line">.rwxr-xr-x  311 root  8 12月  2022 ├── rk3588-pwm15-m3.dtbo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改`armbianEnv`</span></span><br><span class="line">sudo vim /boot/armbianEnv.txt</span><br><span class="line"><span class="comment"># 添加`overlays=pwm2-m1 pwm6-m2 pwm7-m3`（心比较沉，加了三个）</span></span><br><span class="line">overlay_prefix=rk3588</span><br><span class="line">overlays=pwm2-m1 pwm6-m2 pwm7-m3</span><br></pre></td></tr></table></figure>

<p>重启后发现<code>/sys/class/pwm/</code>下出现了另外的<code>pwmchip1</code>、<code>pwmchip2</code>、<code>pwmchip3</code>，此时用<code>exa</code>查看这三个新项目比原来的<code>pwmchip0</code>少一些子目录，可能是没启用导致的，按照radax给的<a target="_blank" rel="noopener" href="https://wiki.radxa.com/Rock5/linux/debian#Fan">风扇的例子</a>启用一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看pwm项目</span></span><br><span class="line">ls /sys/devices/platform/ | grep pwm</span><br><span class="line">fd8b0010.pwm</span><br><span class="line">fd8b0020.pwm</span><br><span class="line">febd0020.pwm</span><br><span class="line">febd0030.pwm</span><br><span class="line"><span class="comment"># 或用exa</span></span><br><span class="line">exa -alt /sys/class/pwm/pwmchip0/</span><br><span class="line">drwxr-xr-x    - root 14 2月  22:57 /sys/class/pwm/pwmchip0</span><br><span class="line">lrwxrwxrwx    0 root 14 2月  22:59 ├── device -&gt; ../../../fd8b0010.pwm</span><br><span class="line"></span><br><span class="line">exa -alt /sys/class/pwm/pwmchip1/</span><br><span class="line">drwxr-xr-x    - root 14 2月  22:57 /sys/class/pwm/pwmchip1</span><br><span class="line">lrwxrwxrwx    0 root 14 2月  22:58 ├── device -&gt; ../../../fd8b0020.pwm</span><br><span class="line"></span><br><span class="line">exa -alt /sys/class/pwm/pwmchip2/</span><br><span class="line">drwxr-xr-x    - root 14 2月  22:57 /sys/class/pwm/pwmchip2</span><br><span class="line">lrwxrwxrwx    0 root 14 2月  22:58 ├── device -&gt; ../../../febd0020.pwm</span><br><span class="line"></span><br><span class="line">exa -alt /sys/class/pwm/pwmchip3/</span><br><span class="line">drwxr-xr-x    - root 14 2月  23:08 /sys/class/pwm/pwmchip3</span><br><span class="line">lrwxrwxrwx    0 root 14 2月  22:58 ├── device -&gt; ../../../febd0030.pwm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用pwm7-m3，引脚pin为27，https://wiki.radxa.com/Rock5/hardware/5b/gpio</span></span><br><span class="line"><span class="built_in">echo</span> 0 &gt; /sys/devices/platform/febd0030.pwm/pwm/pwmchip3/<span class="built_in">export</span> </span><br><span class="line"><span class="comment"># 设置总周期</span></span><br><span class="line"><span class="built_in">echo</span> 10000 &gt; /sys/devices/platform/febd0030.pwm/pwm/pwmchip3/pwm0/period </span><br><span class="line"><span class="comment"># 调整占用时间</span></span><br><span class="line"><span class="built_in">echo</span> 3000 &gt; /sys/devices/platform/febd0030.pwm/pwm/pwmchip3/pwm0/duty_cycle </span><br><span class="line"><span class="built_in">echo</span> normal &gt; /sys/devices/platform/febd0030.pwm/pwm/pwmchip3/pwm0/polarity </span><br><span class="line"><span class="comment"># 打开引脚</span></span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /sys/devices/platform/febd0030.pwm/pwm/pwmchip3/pwm0/<span class="built_in">enable</span> </span><br><span class="line"><span class="comment"># 关闭引脚</span></span><br><span class="line"><span class="built_in">echo</span> 0 &gt; /sys/devices/platform/febd0030.pwm/pwm/pwmchip*/pwm0/<span class="built_in">enable</span> </span><br></pre></td></tr></table></figure>

<p>Armbian上的这个<code>pwmchip*</code>应该是按顺序分配的，不是固定的，所以写成星号比较保险，用前面的<code>fexxxxxx</code>确定针脚就好了。</p>
<h2 id="USB声卡"><a href="#USB声卡" class="headerlink" title="USB声卡"></a>USB声卡</h2><p>群里大佬都说5b这个把3.5mm模拟音频口放在DP电源旁边的操作很魔幻，刚好我有块MOTU M2的外置声卡，走USB让5b只输出数字信号就好了。而且如果是一线通的话声卡直接插显示器通过显示器的USB Hub送到type-c再到5b，也就是5b上始终只有一根type-c线，负责供电、显示以及声卡。</p>
<p>这时候问题就出现了，首先M2官方不支持Linux，然后在Armbian下5b的USB口直接驱动不起来声卡，必须接显示器USB Hub才能有足够的供电，一线通到5b时也能认出来这块声卡，但是播放音频的时候基本上每16秒钟有2-4秒的噪音，这种好了但没完全好的状态非常蛋疼，因为不懂dts也不懂内核，就懒得动手搞底层的东西，只是调了调<code>pulseaudio</code>和<code>alsa</code>的参数，毫无作用。</p>
<p>想到手里还有一块再吃灰的树莓派2b，就想着如果是Armbian的问题，树莓派作为SBC里被支持的最好的设备，声卡什么的应该没问题。一开始拿出RPi-2b送电俩指示灯常亮，插拔SD卡也没反应，很诡异。我换了几个电源都不行，万用表瞎戳也没搞清楚啥情况，都送上咸鱼准备告别了，搜了一下有老外说灯常亮的时候换根线试试，竟然被他说中了……</p>
<p>然后就是在RPi-2b上刷了个Raspberry Pi OS Lite (32-bit)，用当年RPi-2b配的USB 2.4G WiFi连上网，常规<code>update</code>和<code>upgrade</code>后，USB直接插声卡，亮了，说明起码供电没问题。装上<code>pulseaudio</code>，用<code>aplay test.wav</code>放歌试了一下，什么都没设它自动就送到USB声卡上了，没有噪音，很好。此时只需要把RPi-2b配置成PulseAudio Server，把5b配置成PulseAudio Client就好了。按照<a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/470961/how-to-set-up-pulseaudio-remote-properly-and-securely">这个教程</a>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># client and server both</span></span><br><span class="line">sudo apt install pulseaudio-zeroconf <span class="comment"># rock5b上可能是 sudo apt install pulseaudio-module-zeroconf</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> avahi-daemon.service</span><br><span class="line">sudo systemctl start avahi-daemon.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># server side: </span></span><br><span class="line">sudo vim /etc/pulse/default.pa</span><br><span class="line">load-module module-native-protocol-tcp auth-ip-acl=127.0.0.1;192.168.0.0/24 auth-anonymous=1</span><br><span class="line">load-module module-zeroconf-publish</span><br><span class="line"><span class="comment"># restart pulseaudio, check loaded modules</span></span><br><span class="line">pulseaudio -k</span><br><span class="line">pulseaudio --start</span><br><span class="line">pacmd list-modules | grep native-protocol-tcp</span><br><span class="line">pacmd list-modules | grep zeroconf-publish</span><br><span class="line"></span><br><span class="line"><span class="comment"># client side: </span></span><br><span class="line">sudo vim /etc/pulse/default.pa</span><br><span class="line">load-module module-native-protocol-tcp</span><br><span class="line">load-module module-zeroconf-discover</span><br><span class="line"><span class="comment"># restart pulseaudio, check loaded modules</span></span><br><span class="line">pulseaudio -k</span><br><span class="line">pulseaudio --start</span><br><span class="line">pacmd list-modules | grep native-protocol-tcp</span><br><span class="line">pacmd list-modules | grep zeroconf-discover</span><br></pre></td></tr></table></figure>

<p>此时在作为客户端的5b上，用<code>pavucontrol</code>查看输出设备，就已经出现多个RPi-2b上的虚拟输出设备了（多个可能是即有IPv4又有IPv6），选M2即可。测试播放音频，好了但没完全好，明显会有丢帧。RPi-2b（2.4G WiFi）与5b（5G Wifi）互联的延迟挺十几毫秒，有时候还跳上百，可能是因为小区的问题，我家的2.4G信号挺糟糕的。此时只能掏出网线，用RPi-2b跟5b直插，配上另一个段的IP（<code>nmcli</code>配上ipv4后记得改manual）再把RPi-2b的WiFi关了（<code>nmcli</code>里device disconnect或者connection down），重启PulseAudio即可，重新连上后基本解决了丢帧问题，现在听起跟本地设备一样，非常丝滑。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection modify Wired\ connection\ 1 ipv4.addresses 192.168.100.100/24</span><br><span class="line">nmcli connection modify Wired\ connection\ 1 ipv4.method manual</span><br></pre></td></tr></table></figure>

<p>算是半完美解决声卡问题，小团圆结局也是happy ending。</p>
<h2 id="安装硬盘休眠"><a href="#安装硬盘休眠" class="headerlink" title="安装硬盘休眠"></a>安装硬盘休眠</h2><p><a target="_blank" rel="noopener" href="https://github.com/adelolmo/hd-idle/releases/">hd-idle</a>项目可以完成这个任务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/adelolmo/hd-idle</span><br><span class="line"><span class="built_in">cd</span> hd-idle</span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<p>直接运行<code>hd-idle -i 300 -l /mnt/UD_64G/hd-idle.log</code>，即为所有硬盘设置300秒空闲停转时间，并指定日志文件。</p>
<p>我的rock5b直接装不上release的deb，自己编译也不行。不折腾了</p>
<h2 id="安装搜狗输入法（armbian安装可能会有问题）"><a href="#安装搜狗输入法（armbian安装可能会有问题）" class="headerlink" title="安装搜狗输入法（armbian安装可能会有问题）"></a>安装搜狗输入法（armbian安装可能会有问题）</h2><p>apt中貌似没有，得从<a target="_blank" rel="noopener" href="https://shurufa.sogou.com/linux">搜狗官网</a>下载<a target="_blank" rel="noopener" href="https://ime.sogouimecdn.com/202211241829/d93bdc31aea079375adae51381cca02d/dl/gzindex/1656597217/sogoupinyin_4.0.1.2800_arm64.deb">arm64的包</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装输入框架</span></span><br><span class="line">sudo apt install fcitx5</span><br><span class="line"><span class="comment"># 安装输入法</span></span><br><span class="line">sudo apt install ./sougoxxx.deb</span><br></pre></td></tr></table></figure>

<p>然后再系统dock里找到“搜索”，搜“fcitx”启动，搜狗就出现了。</p>
<h2 id="安装VNC（debian可能没有需要安装）"><a href="#安装VNC（debian可能没有需要安装）" class="headerlink" title="安装VNC（debian可能没有需要安装）"></a>安装VNC（debian可能没有需要安装）</h2><p>如此豪华的硬件，必须得体验一下图形界面！随便搜个<a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-vnc-on-debian-11">教程</a>安装VNC服务端：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 大概看一下装了哪些包</span></span><br><span class="line">apt list --installed</span><br><span class="line"><span class="comment"># 已更新且发行版自带了xfce4和xfce4-goodies就不用再装了</span></span><br><span class="line"><span class="comment">#sudo apt update &amp;&amp; sudo apt install xfce4 xfce4-goodies</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装vnc服务端，这个发行版的apt里能搜到这一个vnc的server</span></span><br><span class="line">sudo apt install tightvncserver</span><br><span class="line"><span class="comment"># 安装相关依赖</span></span><br><span class="line">sudo apt install dbus-x11</span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">vncserver</span><br></pre></td></tr></table></figure>

<p>使用<code>vncserver</code>执行首次启动，设置VNC访问密码（6-8位）并让VNC服务端生成配置文件。（我第一次不知道为什么密码没有设置成功，连接失败时日志指示<code>~/.vnc/passwd</code>文件没生成，运行<code>vncpasswd</code>再来一次就可以了）。</p>
<p>接下来自定义VNC服务端配置文件。VNC默认启动于<code>5901</code>端口，默认由<code>:1</code>session占用，先停止默认的实例，再修改配置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开防火墙端口</span></span><br><span class="line">sudo ufw allow 5901/tcp</span><br><span class="line"><span class="comment"># 停止实例`:1`</span></span><br><span class="line">vncserver -<span class="built_in">kill</span> :1</span><br><span class="line"><span class="comment"># 备份配置文件</span></span><br><span class="line">mv ~/.vnc/xstartup ~/.vnc/xstartup.bak</span><br><span class="line"><span class="comment"># 新建配置文件</span></span><br><span class="line">vim ~/.vnc/xstartup</span><br><span class="line"></span><br><span class="line"><span class="comment">#######写入配置#######</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">xrdb <span class="variable">$HOME</span>/.Xresources <span class="comment"># 让VNC的GUI去读取`.Xresources`文件，以指定图形化桌面终端的主题、颜色、字体等。</span></span><br><span class="line">startxfce4 &amp; <span class="comment"># 让VNC启动xfce</span></span><br><span class="line"><span class="comment">#######写入结束#######</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置运行权限</span></span><br><span class="line">sudo chmod +x ~/.vnc/xstartup</span><br><span class="line"><span class="comment"># 再次启动</span></span><br><span class="line">vncserver</span><br></pre></td></tr></table></figure>

<p>VNC本身不使用加密协议，可以使用SSH建立隧道转发VNC以实现加密：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 5901:127.0.0.1:5901 -C -N -l rock 192.168.1.120</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-L</code>：将远端的<code>5901</code>绑定在<code>127.0.0.1</code>的<code>5901</code>上；</li>
<li><code>-C</code>：开启压缩以节省流量；</li>
<li><code>-N</code>：告诉ssh我们不在远端执行命令；</li>
<li><code>-l</code>：指定登录用户名，应使用非root用户登录。</li>
</ul>
<p>这条命令执行后将建立到<code>192.168.1.120</code>的隧道，命令不返回。在VNC客户端里，新建一个到本地<code>127.0.0.1:5901</code>的连接，用户名改成<code>rock</code>，就可以远程了。</p>
<p>将VNC加入系统服务，新建文件<code>sudo vim /etc/systemd/system/vncserver@.service</code>：</p>
<figure class="highlight ini"><figcaption><span>/etc/systemd/system/vncserver@.service</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Start TightVNC server at startup</span><br><span class="line"><span class="attr">After</span>=syslog.target network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=forking</span><br><span class="line"><span class="attr">User</span>=rock</span><br><span class="line"><span class="attr">Group</span>=rock</span><br><span class="line"><span class="attr">WorkingDirectory</span>=/home/rock</span><br><span class="line"></span><br><span class="line"><span class="attr">PIDFile</span>=/home/rock/.vnc/%H:%i.pid</span><br><span class="line"><span class="attr">ExecStartPre</span>=-/usr/bin/vncserver -kill :%i &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="attr">ExecStart</span>=/usr/bin/vncserver -depth <span class="number">24</span> -geometry <span class="number">1280</span>x800 :%i</span><br><span class="line"><span class="attr">ExecStop</span>=/usr/bin/vncserver -kill :%i</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure>

<p>加载配置（<code>@</code>后面的<code>1</code>指的是VNC的<code>:1</code>）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新加载系统配置工具</span></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"><span class="comment"># 启动VNC服务端</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> vncserver@1.service</span><br><span class="line">sudo systemctl start vncserver@1</span><br><span class="line"><span class="comment"># 查看运行状态</span></span><br><span class="line">sudo systemctl status vncserver@1</span><br></pre></td></tr></table></figure>

<p>如果打开chrome上B站发现中文全是方框，则应安装字体（不过前面选过locale就没问题了）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install fonts-wqy-microhei fonts-wqy-zenhei xfonts-intl-chinese xfonts-intl-chinese-big emacs-intl-fonts</span><br></pre></td></tr></table></figure>

<h2 id="安装USB无线网卡（失败）"><a href="#安装USB无线网卡（失败）" class="headerlink" title="安装USB无线网卡（失败）"></a>安装USB无线网卡（失败）</h2><p>随便找了个USB网卡，插入后查看USB设备，找到设备ID为<code>148f:7601 Ralink Technology, Corp. MT7601U Wireless Adapter</code>。查看识别的网络设备，发现这个网卡未识别：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> lsusb</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">Bus 001 Device 004: ID 148f:7601 Ralink Technology, Corp. MT7601U Wireless Adapter</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line">ip a <span class="comment"># 或ip l</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line">2: enP4p65s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p>下载驱动并编译（没搞定没深究）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install linux-headers-generic build-essential</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/art567/mt7601usta.git</span><br><span class="line"><span class="built_in">cd</span> mt7601usta/src </span><br><span class="line">make <span class="comment"># 此时报错 `can&#x27;t find file Kconfig` 就不懂了</span></span><br><span class="line">sudo make install</span><br><span class="line">sudo mkdir -p /etc/Wireless/RT2870STA/</span><br><span class="line">sudo cp RT2870STA.dat /etc/Wireless/RT2870STA/</span><br><span class="line">sudo modprobe mt7601Usta</span><br></pre></td></tr></table></figure>

<p>把吃灰中raspberry pi 2的USB WiFi拔下来，<code>0bda:8176 Realtek Semiconductor Corp. RTL8188CUS 802.11n WLAN Adapter</code>，是个2.4G免驱，解决。</p>
<h2 id="部署matrix"><a href="#部署matrix" class="headerlink" title="部署matrix"></a>部署matrix</h2><p>安装数据库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install postgresql</span><br><span class="line"><span class="comment"># 安装完毕后系统中会自动新增一个`postgres`用户，切换用户</span></span><br><span class="line">sudo -i -u postgres  </span><br><span class="line"><span class="comment"># 登录postgreSQL</span></span><br><span class="line">psql</span><br><span class="line">psql (14.5 (Ubuntu 14.5-0ubuntu0.22.04.1))</span><br><span class="line">Type <span class="string">&quot;help&quot;</span> <span class="keyword">for</span> <span class="built_in">help</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 退出</span></span><br><span class="line">\q</span><br><span class="line"><span class="comment"># 查看状态</span></span><br><span class="line">systemctl status postgresql.service </span><br></pre></td></tr></table></figure>

<p>初始化：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建角色</span></span><br><span class="line">sudo -u postgres createuser -P dendrite</span><br><span class="line"><span class="comment"># 创建数据库（单数据库模式）</span></span><br><span class="line">sudo -u postgres createdb -O dendrite -E UTF-8 dendrite</span><br><span class="line"><span class="comment"># 测试connection string</span></span><br><span class="line">pg_isready -d postgresql://dendrite:dendrite@localhost/dendrite</span><br><span class="line">localhost:5432 - accepting connections</span><br></pre></td></tr></table></figure>

<p>安装golang，nginx：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install golang nginx</span><br><span class="line">go version</span><br><span class="line">go version go1.18.1 linux/arm64</span><br></pre></td></tr></table></figure>

<p>安装并<a target="_blank" rel="noopener" href="https://matrix-org.github.io/dendrite/installation/configuration">配置</a>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载</span></span><br><span class="line">wget https://github.com/matrix-org/dendrite/archive/refs/tags/v0.10.8.zip</span><br><span class="line">unzip /v0.10.8.zip</span><br><span class="line"><span class="built_in">cd</span> ./dendrite-0.10.8</span><br><span class="line"><span class="comment"># 构建安装</span></span><br><span class="line">./build.sh</span><br><span class="line">go install ./cmd/dendrite-monolith-server</span><br><span class="line"><span class="comment"># 生成密钥</span></span><br><span class="line">./bin/generate-keys --private-key matrix_key.pem</span><br><span class="line">Created private key file: matrix_key.pem</span><br><span class="line"><span class="comment"># 按手册提示修改配置文件，若需要命令行添加用户，还需要将`client_api.registration_shared_secret`设置值。</span></span><br></pre></td></tr></table></figure>

<p>启动dendrite，添加用户：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动</span></span><br><span class="line">./dendrite-monolith-server -config /path/to/dendrite.yaml</span><br><span class="line"><span class="comment"># 添加管理员用户</span></span><br><span class="line">./bin/create-account -config ./dendrite.yaml -username admin -admin</span><br><span class="line"><span class="comment"># 添加普通用户</span></span><br><span class="line">./bin/create-account -config ./dendrite.yaml -username qinzishi</span><br></pre></td></tr></table></figure>

<p>下载并解压<a target="_blank" rel="noopener" href="https://github.com/vector-im/element-web/releases">element客户端</a>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/vector-im/element-web/releases/download/v1.11.15/element-v1.11.15.tar.gz</span><br><span class="line">tar -zxvf element-v1.11.15.tar.gz</span><br></pre></td></tr></table></figure>

<p>配置nginx为一个简单的静态文件服务器：</p>
<figure class="highlight plaintext"><figcaption><span>/etc/nginx.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">user www-data;</span><br><span class="line">worker_processes auto;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line">include /etc/nginx/modules-enabled/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 768;</span><br><span class="line">    # multi_accept on;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        location / &#123;</span><br><span class="line">            root /var/aria2c/element-v1.11.15;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="网络问题"><a href="#网络问题" class="headerlink" title="网络问题"></a>网络问题</h2><p>2024/04/14更新：</p>
<p>领导又支援了一块5b。首先是随便买了个rtl8852be，结果<code>lspci</code>时发现verdor id是<code>b85b</code>，而不是原来的<code>b852</code>。整了一个礼拜，试了各种系统，编译了<a target="_blank" rel="noopener" href="https://github.com/lwfinger/rtw89">新驱动</a>，lsmod什么的都能加载驱动，驱动起来也能搜索wifi，但是就是无法连接。我懒得编译旧驱动了，就重新买了块<code>b852</code>的卡。刷了Armbian上的默认系统，这次ok了。</p>
<p>发现了第二个问题，新系统5b的网卡是两块，用上面禁止重命名的方式无法连接，就将就着用了，但是俩个5b在某张卡连wifi时报destination host unreachable。两个5b到别的机子都通，但是互相之间不通。用<code>arp -a</code>或者<code>ip neigh show</code>看ARP表发现是incomplete状态，临时解决办法是在两个5b上都手写一条arp进去：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ip neigh replace to xxx.xxx.xxx.xxx dev wlP2p33s0 lladdr xx:xx:xx:xx:xx:xx nud permanent</span><br></pre></td></tr></table></figure>

<p>临时解决方法就这样了，也可以把命令加在启动脚本里省点事。</p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Linux/">Linux</a></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><div class="social-share"></div><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/alipay.jpg" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/wechatpay.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2022/12/01/first-try-in-obsidian/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">obsidian使用初体验</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2022/09/24/second-vps-from-us/"><span class="level-item">第二个VPS科学球 - 改</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><script src="https://utteranc.es/client.js" repo="zlotus/comment" issue-term="pathname" label="some-issue-label" theme="github-light" crossorigin="anonymous" async></script></div></div></div><div class="column column-left is-3-tablet is-3-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/opm_sq.png" alt="子实"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">子实</p><p class="is-size-6 is-block">程序员</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>陕西/西安</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">81</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">23</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/zlotus" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/zlotus"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com/qinzishi"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/Zealot_uS"><i class="fab fa-twitter"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://www.zhihu.com/people/zlotus" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">知乎</span></span><span class="level-right"><span class="level-item tag">www.zhihu.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Diary/"><span class="level-start"><span class="level-item">Diary</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">67</span></span></a></li><li><a class="level is-mobile" href="/categories/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Shell/"><span class="level-start"><span class="level-item">Shell</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Coroutines/"><span class="tag">Coroutines</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaScript/"><span class="tag">JavaScript</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Javascript/"><span class="tag">Javascript</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">33</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenCV/"><span class="tag">OpenCV</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Operating-System/"><span class="tag">Operating System</span><span class="tag">21</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Paper/"><span class="tag">Paper</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">20</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Raspberry-Pi/"><span class="tag">Raspberry Pi</span><span class="tag">20</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Rust/"><span class="tag">Rust</span><span class="tag">29</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Shell/"><span class="tag">Shell</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TensorFlow/"><span class="tag">TensorFlow</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tokio/"><span class="tag">Tokio</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ZMQ/"><span class="tag">ZMQ</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ctpn/"><span class="tag">ctpn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/llama/"><span class="tag">llama</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/macOS/"><span class="tag">macOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/obsidion/"><span class="tag">obsidion</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%97%A5%E8%AE%B0/"><span class="tag">日记</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9D%82%E8%B0%88/"><span class="tag">杂谈</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%AE%97%E6%B3%95/"><span class="tag">算法</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BC%96%E7%A8%8B/"><span class="tag">编程</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%84%9A%E6%9C%AC/"><span class="tag">脚本</span><span class="tag">4</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/opm_sq.png" alt="子实" height="28"></a><p class="is-size-7"><span>&copy; 2024 子实</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>